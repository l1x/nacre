# tools
[tools]
rust = "1.90.0"
bun = "latest"

# env

# tasks
[tasks.lint]
description = "Lint Rust with Clippy, failing on warnings"
run = "cargo clippy -- -D warnings"

[tasks.install-js-deps]
description = "Bun install packages"
run = "bun install"

[tasks.lint-ts]
description = "Lint TypeScript with ESLint (security plugin)"
run = "bun run lint"

[tasks.lint-all]
description = "Run all linters (Rust + TypeScript)"
depends = ["lint", "lint-ts"]

[tasks.fmt]
description = "Format code with cargo fmt"
run = "cargo fmt"

[tasks.tests]
description = "Running tests"
run = "cargo test -- --nocapture"

[tasks.bench-markdown-comparison]
description = "Running markdown-comparison benchmark"
run = "cargo bench --bench markdown_comparison"

[tasks.bench-tree-building]
description = "Running tree-building benchmark"
run = "cargo bench --bench tree_building"

[tasks.build-dev]
description = "Building the development version"
run = "cargo build"

[tasks.build-js-prod]
description = "Build frontend TypeScript into bundled app.js"
run = "bun build ./frontend/src/main.ts --outfile ./frontend/public/app.js --target browser"
depends = ["lint-ts"]

[tasks.build-prod]
description = "Building the release version"
run = "cargo build --release"
depends = ["build-js-prod"]

[tasks.build-prod-with-timings]
description = "Building the release version"
run = "cargo build --release --timings"

[tasks.show-issues]
description = "List all open issues"
run = "bd list --status open"

[tasks.show-ready]
description = "Show ready work (no blockers)"
run = "bd ready"

[tasks.show-blocked]
description = "Show blocked issues"
run = "bd blocked"

[tasks.show-issue-stats]
description = "Show issue statistics"
run = "bd stats"

[tasks.show-issue-tree]
description = "Show dependency tree for an issue (use: mise run issue-tree -- bd-1)"
run = "bd dep tree"

[tasks.coverage]
description = "Run tests with coverage using cargo-tarpaulin"
run = "cargo tarpaulin --out Stdout --skip-clean"

[tasks.coverage-html]
description = "Run tests with coverage and generate HTML report"
run = "cargo tarpaulin --out Html --skip-clean --output-dir target/tarpaulin"

[tasks.audit]
description = "Run security audit on dependencies"
run = "cargo audit"

[tasks.machete]
description = "Find unused dependencies"
run = "cargo machete"

[tasks.check-deps]
description = "Run security audit and find unused dependencies"
depends = ["audit", "machete"]

[tasks.start-dev-server]
description = "Building the development version"
run = "cargo run -- --open"
depends = ["build-js-prod"]

[tasks.publish]
description = "Publish crate to crates.io"
run = "cargo publish"
depends = ["lint", "tests", "build-prod"]
