(function(){let m=localStorage.getItem("theme"),L=window.matchMedia("(prefers-color-scheme: dark)").matches,M=m||(L?"dark":"light");document.documentElement.setAttribute("data-theme",M)})();function D(){let m=document.getElementById("theme-toggle");if(m){let L=()=>{let M=document.documentElement.getAttribute("data-theme");m.textContent=M==="dark"?"☀️":"\uD83C\uDF19"};L(),m.addEventListener("click",()=>{let f=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";document.documentElement.setAttribute("data-theme",f),localStorage.setItem("theme",f),L()})}}function N(){let m=document.getElementById("filter-input");if(m)m.addEventListener("input",(L)=>{let M=L.target.value.toLowerCase();document.querySelectorAll("[data-filter-text]").forEach((r)=>{let q=r.getAttribute("data-filter-text"),G=q&&q.includes(M);if(r instanceof HTMLElement)if(G)r.style.display="";else r.style.display="none"})})}function P(){document.addEventListener("click",(m)=>{let M=m.target.closest(".toggle-children");if(!M)return;let f=M.closest(".epic-item");if(!f)return;let r=f.querySelector(".epic-children");if(!r)return;let q=r.classList.contains("collapsed");if(r.classList.toggle("collapsed"),M.classList.toggle("expanded"),q)r.style.maxHeight=r.scrollHeight+"px",r.style.opacity="1";else r.style.maxHeight="0",r.style.opacity="0"})}class Y{container=null;activeToasts=new Set;initialized=!1;constructor(){if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>this.init());else this.init()}init(){if(this.initialized)return;this.container=document.createElement("div"),this.container.id="toast-container",this.container.className="toast-container",document.body.appendChild(this.container),this.initialized=!0}createToast(m){let L=document.createElement("div");L.className=`toast toast-${m.type||"info"}`;let M=document.createElement("div");M.className="toast-message",M.textContent=m.message;let f=document.createElement("div");if(f.className="toast-actions",m.retryAction){let q=document.createElement("button");q.className="toast-retry",q.textContent="Retry",q.addEventListener("click",async()=>{q.disabled=!0,q.textContent="Retrying...";try{await m.retryAction(),this.remove(L),this.show({message:"Success!",type:"success",duration:2000})}catch{q.disabled=!1,q.textContent="Retry"}}),f.appendChild(q)}let r=document.createElement("button");return r.className="toast-close",r.textContent="×",r.addEventListener("click",()=>this.remove(L)),f.appendChild(r),L.appendChild(M),L.appendChild(f),L}show(m){if(!this.initialized)return;if(!this.container)return;let L=this.createToast(m);if(this.container.appendChild(L),this.activeToasts.add(L),setTimeout(()=>{L.classList.add("toast-show")},10),m.duration&&m.duration>0)setTimeout(()=>{this.remove(L)},m.duration)}remove(m){m.classList.remove("toast-show"),setTimeout(()=>{if(m.parentNode)m.parentNode.removeChild(m);this.activeToasts.delete(m)},300)}clear(){this.activeToasts.forEach((m)=>this.remove(m))}}var C=new Y;function A(m,L,M){let f=m instanceof Error?m.message:"Unknown error occurred";console.error(`[${L}] ${f}`,m),C.show({message:`${L}: ${f}`,type:"error",duration:M?0:5000,retryAction:M})}function W(m,L,M){let f=`HTTP ${m.status}: ${m.statusText}`;console.error(`[${L}] ${f}`,m),C.show({message:`${L}: ${f}`,type:"error",duration:M?0:5000,retryAction:M})}function w(){document.addEventListener("click",(L)=>{let M=L.target;if(M.classList.contains("issue-title")&&M.closest(".issue-item"))m(M)});function m(L){let M=L.innerText,f=document.createElement("input");f.type="text",f.value=M,f.classList.add("edit-input"),f.addEventListener("click",(E)=>E.stopPropagation()),L.replaceWith(f),f.focus();let r=!1,q=async()=>{if(r)return;r=!0;let E=f.value.trim(),j=f.closest(".issue-item"),$=j?j.getAttribute("data-id"):null;if(E&&E!==M&&$){let u=async()=>{if(!(await fetch(`/api/issues/${$}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:E})})).ok)throw Error("Update failed")};try{await u();let X=document.createElement("div");X.classList.add("issue-title"),X.innerText=E,f.replaceWith(X)}catch(X){if(X instanceof Error&&X.message==="Update failed")W(new Response(null,{status:500,statusText:"Update failed"}),"Failed to update title",u);else A(X,"Failed to update title",u)}}else G()},G=()=>{let E=document.createElement("div");E.classList.add("issue-title"),E.innerText=M,f.replaceWith(E)};f.addEventListener("blur",q),f.addEventListener("keydown",(E)=>{if(E.key==="Enter")f.blur();else if(E.key==="Escape")G(),r=!0})}}var y={OPEN:"open",IN_PROGRESS:"in_progress",BLOCKED:"blocked",CLOSED:"closed",DEFERRED:"deferred"},v={[y.OPEN]:0,[y.IN_PROGRESS]:1,[y.BLOCKED]:2,[y.CLOSED]:3,[y.DEFERRED]:4},z={EPIC:"epic",FEATURE:"feature",BUG:"bug",TASK:"task",CHORE:"chore"},O={[z.EPIC]:0,[z.FEATURE]:1,[z.BUG]:2,[z.TASK]:3,[z.CHORE]:4};var T=Object.values(y);function U(m){return T.includes(m)}function a(){let m=document.getElementById("columns-toggle"),L=document.getElementById("columns-dropdown");if(m&&L){let G=function(j,$){let u=document.querySelector(`.board-column[data-status="${j}"]`);if(u)u.style.display=$?"":"none"},E=function(){let j={};q().forEach(($)=>{let u=$.getAttribute("data-status");if(u&&U(u))j[u]=$.checked}),localStorage.setItem("board-column-visibility",JSON.stringify(j))},f=localStorage.getItem("board-column-visibility"),r=f?JSON.parse(f):null,q=()=>L.querySelectorAll('input[type="checkbox"]');q().forEach((j)=>{let $=j.getAttribute("data-status");if(!$||!U($))return;if(r===null)j.checked=$!==y.DEFERRED;else j.checked=r[$]!==!1;G($,j.checked)}),L.addEventListener("change",(j)=>{let $=j.target;if($.type!=="checkbox")return;let u=$.getAttribute("data-status");if(!u)return;G(u,$.checked),E()}),m.addEventListener("click",(j)=>{j.stopPropagation(),L.classList.toggle("show")}),document.addEventListener("click",(j)=>{if(!L.contains(j.target)&&j.target!==m)L.classList.remove("show")}),L.addEventListener("click",(j)=>{j.stopPropagation()})}let M=()=>{let f=document.querySelectorAll(".type-filter");if(f.length===0)return;let r=new Set(Array.from(f).filter((G)=>G.checked).map((G)=>G.value));document.querySelectorAll(".issue-card").forEach((G)=>{let E=!1;for(let j of r)if(G.classList.contains(`issue-type-${j}`)){E=!0;break}G.classList.toggle("hidden-by-type",!E)})};document.addEventListener("change",(f)=>{if(f.target.classList.contains("type-filter"))M()}),M()}function I(){let m=document.querySelectorAll('.issue-card[draggable="true"]'),L=document.querySelectorAll(".column-content");if(m.length>0&&L.length>0)m.forEach((f)=>{f.addEventListener("dragstart",()=>{f.classList.add("dragging"),f.style.opacity="0.5"}),f.addEventListener("dragend",()=>{f.classList.remove("dragging"),f.style.opacity="1"})}),L.forEach((f)=>{f.addEventListener("dragover",(r)=>{r.preventDefault();let q=document.querySelector(".dragging");if(q){let G=M(f,r.clientY);if(G==null)f.appendChild(q);else f.insertBefore(q,G)}}),f.addEventListener("drop",async()=>{let r=document.querySelector(".dragging");if(!r)return;let q=f.getAttribute("data-status"),G=r.getAttribute("data-id");if(G&&q){let E=async()=>{if(!(await fetch(`/api/issues/${G}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:q})})).ok)throw Error("Update failed")};try{await E()}catch(j){if(j instanceof Error&&j.message==="Update failed")W(new Response(null,{status:500,statusText:"Update failed"}),"Failed to update status",E);else A(j,"Failed to update status",E)}}})});function M(f,r){return[...f.querySelectorAll(".issue-card:not(.dragging)")].reduce((E,j)=>{let $=j.getBoundingClientRect(),u=r-$.top-$.height/2;if(u<0&&u>E.offset)return{offset:u,element:j};else return E},{offset:Number.NEGATIVE_INFINITY,element:null}).element}}function _(){let m=-1,L=0,M=0,f=document.querySelector(".board")!==null,r=document.querySelector(".issue-list")!==null;if(f)$();document.addEventListener("keydown",(u)=>{let X=u.target;if(X.tagName==="INPUT"||X.tagName==="TEXTAREA")return;if(u.key==="Backspace"){u.preventDefault(),window.history.back();return}if(r)q(u);else if(f)G(u)});function q(u){let X=Array.from(document.querySelectorAll('.issue-item:not([style*="display: none"])'));if(X.length===0)return;let H=document.querySelector(".issue-item.selected");if(H)m=X.indexOf(H);if(u.key==="j"||u.key==="ArrowDown"){m=Math.min(m+1,X.length-1);let k=X.at(m);if(k)j(k);u.preventDefault()}else if(u.key==="k"||u.key==="ArrowUp"){m=Math.max(m-1,0);let k=X.at(m);if(k)j(k);u.preventDefault()}else if(u.key==="Enter"||u.key==="o"){if(H){let k=H.querySelector(".issue-meta a");if(k)k.click()}}}function G(u){let X=Array.from(document.querySelectorAll('.board-column:not([style*="display: none"])'));if(X.length===0)return;if(u.key==="j"||u.key==="ArrowDown"){let H=X.at(L);if(!H)return;let k=E(H);if(k.length>0)M=Math.min(M+1,k.length-1),$(),u.preventDefault()}else if(u.key==="k"||u.key==="ArrowUp")M=Math.max(M-1,0),$(),u.preventDefault();else if(u.key==="h"||u.key==="ArrowLeft"){L=Math.max(L-1,0);let H=X.at(L);if(!H)return;let k=E(H);M=Math.min(M,Math.max(0,k.length-1)),$(),u.preventDefault()}else if(u.key==="l"||u.key==="ArrowRight"){L=Math.min(L+1,X.length-1);let H=X.at(L);if(!H)return;let k=E(H);M=Math.min(M,Math.max(0,k.length-1)),$(),u.preventDefault()}else if(u.key==="Enter"||u.key==="o"){let H=document.querySelector(".issue-card.selected");if(H){let k=H.querySelector("a");if(k)k.click()}}}function E(u){if(!u)return[];return Array.from(u.querySelectorAll('.issue-card:not([style*="display: none"])'))}function j(u){if(document.querySelectorAll(".issue-item.selected").forEach((X)=>X.classList.remove("selected")),u)u.classList.add("selected"),u.scrollIntoView({behavior:"smooth",block:"nearest"})}function $(){let u=Array.from(document.querySelectorAll('.board-column:not([style*="display: none"])'));if(u.length===0)return;L=Math.max(0,Math.min(L,u.length-1));let X=u.at(L);if(!X)return;let H=E(X);if(document.querySelectorAll(".issue-card.selected").forEach((k)=>k.classList.remove("selected")),H.length>0){M=Math.max(0,Math.min(M,H.length-1));let k=H.at(M);if(k)k.classList.add("selected"),k.scrollIntoView({behavior:"smooth",block:"nearest"})}}}function c(){let m=document.querySelector(".tree-view");if(!m)return;let L=m.querySelector(".tree-list"),M=document.querySelector(".controls-grid")||document.querySelector(".child-expand-controls"),f=new Set,r=()=>m.querySelectorAll(".tree-node"),q=()=>document.querySelectorAll(".type-filter");if(m.getAttribute("data-issue-type")===z.TASK)r().forEach((H)=>{if(H.getAttribute("data-has-children")==="true"){let J=H.getAttribute("data-id");if(J){f.add(J);let F=H.querySelector(".tree-toggle");if(F){F.classList.add("expanded");let K=F.querySelector(".toggle-icon");if(K)K.textContent="−"}}}});function E(){let H=q(),k=H.length>0?new Set(Array.from(H).filter((J)=>J.checked).map((J)=>J.value)):null;r().forEach((J)=>{let F=J.getAttribute("data-parent")||"",K=J.getAttribute("data-type")||"",Q=!1;if(!F)Q=!0;else if(f.has(F))Q=!0;if(Q&&k&&!k.has(K))Q=!1;J.classList.toggle("hidden",!Q)})}if(L)L.addEventListener("click",(H)=>{let J=H.target.closest(".tree-toggle");if(!J)return;H.preventDefault(),H.stopPropagation();let F=J.closest(".tree-node");if(!F)return;let K=F.getAttribute("data-id");if(!K)return;if(f.has(K)){f.delete(K),J.classList.remove("expanded");let Q=J.querySelector(".toggle-icon");if(Q)Q.textContent="+"}else{f.add(K),J.classList.add("expanded");let Q=J.querySelector(".toggle-icon");if(Q)Q.textContent="−"}E()});if(document.addEventListener("change",(H)=>{if(H.target.classList.contains("type-filter"))E()}),M)M.addEventListener("click",(H)=>{let J=H.target.closest("button");if(!J)return;let F=J.id;if(F==="expand-all"||F==="detail-expand")j();else if(F==="collapse-all"||F==="detail-collapse")$();else if(F==="expand-one-level")u();else if(F==="collapse-one-level")X()});function j(){r().forEach((H)=>{if(H.getAttribute("data-has-children")==="true"){let J=H.getAttribute("data-id");if(J){f.add(J);let F=H.querySelector(".tree-toggle");if(F){F.classList.add("expanded");let K=F.querySelector(".toggle-icon");if(K)K.textContent="−"}}}}),E()}function $(){f.clear(),r().forEach((H)=>{let k=H.querySelector(".tree-toggle");if(k){k.classList.remove("expanded");let J=k.querySelector(".toggle-icon");if(J)J.textContent="+"}}),E()}function u(){let H=r(),k=-1;H.forEach((K)=>{let Q=K.getAttribute("data-id");if(Q&&f.has(Q)){let Z=parseInt(K.getAttribute("data-depth")||"0");if(Z>k)k=Z}});let J=k+1,F=[];H.forEach((K)=>{let Q=parseInt(K.getAttribute("data-depth")||"0"),Z=K.getAttribute("data-id"),l=K.getAttribute("data-has-children")==="true",R=K.getAttribute("data-parent");if(Z&&l&&!f.has(Z)){if(Q<=J){if(!R||f.has(R))F.push({id:Z,element:K})}}}),F.forEach(({id:K,element:Q})=>{f.add(K);let Z=Q.querySelector(".tree-toggle");if(Z){Z.classList.add("expanded");let l=Z.querySelector(".toggle-icon");if(l)l.textContent="−"}}),E()}function X(){let H=r(),k=0;f.forEach((J)=>{H.forEach((F)=>{if(F.getAttribute("data-id")===J){let K=parseInt(F.getAttribute("data-depth")||"0");k=Math.max(k,K)}})}),H.forEach((J)=>{let F=parseInt(J.getAttribute("data-depth")||"0"),K=J.getAttribute("data-id"),Q=J.getAttribute("data-has-children")==="true";if(K&&Q&&F>k-1){f.delete(K);let Z=J.querySelector(".tree-toggle");if(Z){Z.classList.remove("expanded");let l=Z.querySelector(".toggle-icon");if(l)l.textContent="+"}}}),E()}E()}function h(){let m=document.querySelector(".graph-tree-container"),L=document.getElementById("epic-select");if(!m)return;if(L)L.addEventListener("change",()=>{let M=L.value;if(M)window.location.href=`/graph/${M}`;else window.location.href="/graph"});m.addEventListener("click",(M)=>{let f=M.target.closest(".tree-toggle");if(!f)return;let q=f.closest(".tree-node")?.dataset.id;if(!q)return;let G=f.classList.toggle("expanded");V(q,G)})}function V(m,L){document.querySelectorAll(`[data-parent="${m}"]`).forEach((M)=>{if(M.classList.toggle("hidden",!L),!L){let f=M.dataset.id;if(f){let r=M.querySelector(".tree-toggle");if(r?.classList.contains("expanded"))r.classList.remove("expanded"),V(f,!1)}}})}var x=["status","type","priority"];function s(m){return x.includes(m)}function S(){document.addEventListener("click",(m)=>{let M=m.target.closest(".sort-btn");if(!M)return;if(M.classList.contains("active")){B(),M.classList.remove("active");return}let f=M.getAttribute("data-sort");if(f&&s(f))b(f),i(M)})}function B(){window.location.reload()}function b(m){let L=document.querySelector(".tree-list");if(!L)return;let M=Array.from(L.querySelectorAll(".tree-node")),f=new Map;M.forEach((q)=>{let G=q.querySelector(".tree-toggle");if(G&&G.classList.contains("expanded"))f.set(q.dataset.id,!0)}),M.sort((q,G)=>n(q,G,m)),L.classList.add("sorting-active"),document.querySelectorAll("#expand-all, #collapse-all, #expand-one-level, #collapse-one-level").forEach((q)=>{q.disabled=!0}),L.innerHTML="",M.forEach((q)=>{if(q.classList.remove("hidden"),L.appendChild(q),f.has(q.dataset.id)){let G=q.querySelector(".tree-toggle");if(G){G.classList.add("expanded");let E=G.querySelector(".toggle-icon");if(E)E.textContent="−"}}})}function n(m,L,M){switch(M){case"status":return g(m.dataset.status,L.dataset.status);case"type":return p(m.dataset.type,L.dataset.type);case"priority":return t(m.dataset.priority,L.dataset.priority);default:return 0}}function g(m,L){let M=v[m]??999,f=v[L]??999;return M-f}function p(m,L){let M=O[m]??999,f=O[L]??999;return M-f}function t(m,L){let M=parseInt(m)||999,f=parseInt(L)||999;return M-f}function i(m){document.querySelectorAll(".sort-btn").forEach((M)=>{M.classList.remove("active")}),m.classList.add("active")}document.addEventListener("DOMContentLoaded",()=>{D(),N(),P(),w(),a(),I(),_(),c(),h(),S()});
