var C=["nacre-light","catppuccin-latte"];(function(){let m=localStorage.getItem("theme"),M=window.matchMedia("(prefers-color-scheme: dark)").matches,L=m||(M?"nacre-dark":"nacre-light");document.documentElement.setAttribute("data-theme",L);let f=C.includes(L)?"light":"dark";document.documentElement.setAttribute("data-syntax",f)})();function _(){let m=document.getElementById("theme-select");if(m){let M=document.documentElement.getAttribute("data-theme")||"nacre-dark";m.value=M,m.addEventListener("change",()=>{let L=m.value;document.documentElement.setAttribute("data-theme",L),localStorage.setItem("theme",L);let f=C.includes(L)?"light":"dark";document.documentElement.setAttribute("data-syntax",f)})}}function R(){let m=document.getElementById("filter-input");if(m)m.addEventListener("input",(M)=>{let L=M.target.value.toLowerCase();document.querySelectorAll("[data-filter-text]").forEach((q)=>{let H=q.getAttribute("data-filter-text"),J=H&&H.includes(L);if(q instanceof HTMLElement)if(J)q.style.display="";else q.style.display="none"})})}function v(){document.addEventListener("click",(m)=>{let L=m.target.closest(".toggle-children");if(!L)return;let f=L.closest(".epic-item");if(!f)return;let q=f.querySelector(".epic-children");if(!q)return;let H=q.classList.contains("collapsed");if(q.classList.toggle("collapsed"),L.classList.toggle("expanded"),H)q.style.maxHeight=q.scrollHeight+"px",q.style.opacity="1";else q.style.maxHeight="0",q.style.opacity="0"})}class w{container=null;activeToasts=new Set;initialized=!1;constructor(){if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>this.init());else this.init()}init(){if(this.initialized)return;this.container=document.createElement("div"),this.container.id="toast-container",this.container.className="toast-container",document.body.appendChild(this.container),this.initialized=!0}createToast(m){let M=document.createElement("div");M.className=`toast toast-${m.type||"info"}`;let L=document.createElement("div");L.className="toast-message",L.textContent=m.message;let f=document.createElement("div");if(f.className="toast-actions",m.retryAction){let H=document.createElement("button");H.className="toast-retry",H.textContent="Retry",H.addEventListener("click",async()=>{H.disabled=!0,H.textContent="Retrying...";try{await m.retryAction(),this.remove(M),this.show({message:"Success!",type:"success",duration:2000})}catch{H.disabled=!1,H.textContent="Retry"}}),f.appendChild(H)}let q=document.createElement("button");return q.className="toast-close",q.textContent="×",q.addEventListener("click",()=>this.remove(M)),f.appendChild(q),M.appendChild(L),M.appendChild(f),M}show(m){if(!this.initialized)return;if(!this.container)return;let M=this.createToast(m);if(this.container.appendChild(M),this.activeToasts.add(M),setTimeout(()=>{M.classList.add("toast-show")},10),m.duration&&m.duration>0)setTimeout(()=>{this.remove(M)},m.duration)}remove(m){m.classList.remove("toast-show"),setTimeout(()=>{if(m.parentNode)m.parentNode.removeChild(m);this.activeToasts.delete(m)},300)}clear(){this.activeToasts.forEach((m)=>this.remove(m))}}var V=new w;function P(m,M,L){let f=m instanceof Error?m.message:"Unknown error occurred";console.error(`[${M}] ${f}`,m),V.show({message:`${M}: ${f}`,type:"error",duration:L?0:5000,retryAction:L})}function I(m,M,L){let f=`HTTP ${m.status}: ${m.statusText}`;console.error(`[${M}] ${f}`,m),V.show({message:`${M}: ${f}`,type:"error",duration:L?0:5000,retryAction:L})}function S(){document.addEventListener("click",(M)=>{let L=M.target;if(L.classList.contains("issue-title")&&L.closest(".issue-item"))m(L)});function m(M){let L=M.innerText,f=document.createElement("input");f.type="text",f.value=L,f.classList.add("edit-input"),f.addEventListener("click",(j)=>j.stopPropagation()),M.replaceWith(f),f.focus();let q=!1,H=async()=>{if(q)return;q=!0;let j=f.value.trim(),G=f.closest(".issue-item"),K=G?G.getAttribute("data-id"):null;if(j&&j!==L&&K){let u=async()=>{if(!(await fetch(`/api/issues/${K}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:j})})).ok)throw Error("Update failed")};try{await u();let F=document.createElement("div");F.classList.add("issue-title"),F.innerText=j,f.replaceWith(F)}catch(F){if(F instanceof Error&&F.message==="Update failed")I(new Response(null,{status:500,statusText:"Update failed"}),"Failed to update title",u);else P(F,"Failed to update title",u)}}else J()},J=()=>{let j=document.createElement("div");j.classList.add("issue-title"),j.innerText=L,f.replaceWith(j)};f.addEventListener("blur",H),f.addEventListener("keydown",(j)=>{if(j.key==="Enter")f.blur();else if(j.key==="Escape")J(),q=!0})}}var A={OPEN:"open",IN_PROGRESS:"in_progress",BLOCKED:"blocked",CLOSED:"closed",DEFERRED:"deferred"},U={[A.OPEN]:0,[A.IN_PROGRESS]:1,[A.BLOCKED]:2,[A.CLOSED]:3,[A.DEFERRED]:4},O={EPIC:"epic",FEATURE:"feature",BUG:"bug",TASK:"task",CHORE:"chore"},Y={[O.EPIC]:0,[O.FEATURE]:1,[O.BUG]:2,[O.TASK]:3,[O.CHORE]:4};var s=Object.values(A);function x(m){return s.includes(m)}function a(){let m=document.getElementById("columns-toggle"),M=document.getElementById("columns-dropdown");if(m&&M){let J=function(G,K){let u=document.querySelector(`.board-column[data-status="${G}"]`);if(u)u.style.display=K?"":"none"},j=function(){let G={};H().forEach((K)=>{let u=K.getAttribute("data-status");if(u&&x(u))G[u]=K.checked}),localStorage.setItem("board-column-visibility",JSON.stringify(G))},f=localStorage.getItem("board-column-visibility"),q=f?JSON.parse(f):null,H=()=>M.querySelectorAll('input[type="checkbox"]');H().forEach((G)=>{let K=G.getAttribute("data-status");if(!K||!x(K))return;if(q===null)G.checked=K!==A.DEFERRED;else G.checked=q[K]!==!1;J(K,G.checked)}),M.addEventListener("change",(G)=>{let K=G.target;if(K.type!=="checkbox")return;let u=K.getAttribute("data-status");if(!u)return;J(u,K.checked),j()}),m.addEventListener("click",(G)=>{G.stopPropagation(),M.classList.toggle("show")}),document.addEventListener("click",(G)=>{if(!M.contains(G.target)&&G.target!==m)M.classList.remove("show")}),M.addEventListener("click",(G)=>{G.stopPropagation()})}let L=()=>{let f=document.querySelectorAll(".type-filter");if(f.length===0)return;let q=new Set(Array.from(f).filter((J)=>J.checked).map((J)=>J.value));document.querySelectorAll(".issue-card").forEach((J)=>{let j=!1;for(let G of q)if(J.classList.contains(`issue-type-${G}`)){j=!0;break}J.classList.toggle("hidden-by-type",!j)})};document.addEventListener("change",(f)=>{if(f.target.classList.contains("type-filter"))L()}),L()}function l(){let m=document.querySelectorAll('.issue-card[draggable="true"]'),M=document.querySelectorAll(".column-content");if(m.length>0&&M.length>0)m.forEach((f)=>{f.addEventListener("dragstart",()=>{f.classList.add("dragging"),f.style.opacity="0.5"}),f.addEventListener("dragend",()=>{f.classList.remove("dragging"),f.style.opacity="1"})}),M.forEach((f)=>{f.addEventListener("dragover",(q)=>{q.preventDefault();let H=document.querySelector(".dragging");if(H){let J=L(f,q.clientY);if(J==null)f.appendChild(H);else f.insertBefore(H,J)}}),f.addEventListener("drop",async()=>{let q=document.querySelector(".dragging");if(!q)return;let H=f.getAttribute("data-status"),J=q.getAttribute("data-id");if(J&&H){let j=async()=>{if(!(await fetch(`/api/issues/${J}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:H})})).ok)throw Error("Update failed")};try{await j()}catch(G){if(G instanceof Error&&G.message==="Update failed")I(new Response(null,{status:500,statusText:"Update failed"}),"Failed to update status",j);else P(G,"Failed to update status",j)}}})});function L(f,q){return[...f.querySelectorAll(".issue-card:not(.dragging)")].reduce((j,G)=>{let K=G.getBoundingClientRect(),u=q-K.top-K.height/2;if(u<0&&u>j.offset)return{offset:u,element:G};else return j},{offset:Number.NEGATIVE_INFINITY,element:null}).element}}function r(){let m=-1,M=0,L=0,f=document.querySelector(".board")!==null,q=document.querySelector(".issue-list")!==null;if(f)K();document.addEventListener("keydown",(u)=>{let F=u.target;if(F.tagName==="INPUT"||F.tagName==="TEXTAREA")return;if(u.key==="Backspace"){u.preventDefault(),window.history.back();return}if(q)H(u);else if(f)J(u)});function H(u){let F=Array.from(document.querySelectorAll('.issue-item:not([style*="display: none"])'));if(F.length===0)return;let k=document.querySelector(".issue-item.selected");if(k)m=F.indexOf(k);if(u.key==="j"||u.key==="ArrowDown"){m=Math.min(m+1,F.length-1);let E=F.at(m);if(E)G(E);u.preventDefault()}else if(u.key==="k"||u.key==="ArrowUp"){m=Math.max(m-1,0);let E=F.at(m);if(E)G(E);u.preventDefault()}else if(u.key==="Enter"||u.key==="o"){if(k){let E=k.querySelector(".issue-meta a");if(E)E.click()}}}function J(u){let F=Array.from(document.querySelectorAll('.board-column:not([style*="display: none"])'));if(F.length===0)return;if(u.key==="j"||u.key==="ArrowDown"){let k=F.at(M);if(!k)return;let E=j(k);if(E.length>0)L=Math.min(L+1,E.length-1),K(),u.preventDefault()}else if(u.key==="k"||u.key==="ArrowUp")L=Math.max(L-1,0),K(),u.preventDefault();else if(u.key==="h"||u.key==="ArrowLeft"){M=Math.max(M-1,0);let k=F.at(M);if(!k)return;let E=j(k);L=Math.min(L,Math.max(0,E.length-1)),K(),u.preventDefault()}else if(u.key==="l"||u.key==="ArrowRight"){M=Math.min(M+1,F.length-1);let k=F.at(M);if(!k)return;let E=j(k);L=Math.min(L,Math.max(0,E.length-1)),K(),u.preventDefault()}else if(u.key==="Enter"||u.key==="o"){let k=document.querySelector(".issue-card.selected");if(k){let E=k.querySelector("a");if(E)E.click()}}}function j(u){if(!u)return[];return Array.from(u.querySelectorAll('.issue-card:not([style*="display: none"])'))}function G(u){if(document.querySelectorAll(".issue-item.selected").forEach((F)=>F.classList.remove("selected")),u)u.classList.add("selected"),u.scrollIntoView({behavior:"smooth",block:"nearest"})}function K(){let u=Array.from(document.querySelectorAll('.board-column:not([style*="display: none"])'));if(u.length===0)return;M=Math.max(0,Math.min(M,u.length-1));let F=u.at(M);if(!F)return;let k=j(F);if(document.querySelectorAll(".issue-card.selected").forEach((E)=>E.classList.remove("selected")),k.length>0){L=Math.max(0,Math.min(L,k.length-1));let E=k.at(L);if(E)E.classList.add("selected"),E.scrollIntoView({behavior:"smooth",block:"nearest"})}}}function g(){let m=document.querySelector(".org-tree");if(!m)return;let M=m.querySelector(".org-tree-svg");if(!M)M=document.createElementNS("http://www.w3.org/2000/svg","svg"),M.classList.add("org-tree-svg"),M.style.position="absolute",M.style.top="0",M.style.left="0",M.style.width="100%",M.style.height="100%",M.style.pointerEvents="none",M.style.overflow="visible",m.style.position="relative",m.insertBefore(M,m.firstChild);function L(){M.innerHTML="";let J=getComputedStyle(document.documentElement).getPropertyValue("--border-color").trim()||"#585b70";m.querySelectorAll("li").forEach((G)=>{let K=G.querySelector(":scope > a.org-node, :scope > .org-node"),u=G.querySelector(":scope > ul");if(!K||!u)return;let F=u.querySelectorAll(":scope > li");if(F.length===0)return;let k=K.getBoundingClientRect(),E=m.getBoundingClientRect(),$=k.left+k.width/2-E.left,Q=k.bottom-E.top;F.forEach((Z)=>{let y=Z.querySelector(":scope > a.org-node, :scope > .org-node");if(!y)return;let z=y.getBoundingClientRect(),X=z.left+z.width/2-E.left,D=z.top-E.top,N=(Q+D)/2,W=document.createElementNS("http://www.w3.org/2000/svg","path"),B=`M ${$} ${Q} C ${$} ${N}, ${X} ${N}, ${X} ${D}`;W.setAttribute("d",B),W.setAttribute("fill","none"),W.setAttribute("stroke",J),W.setAttribute("stroke-width","2"),W.setAttribute("stroke-linecap","round"),M.appendChild(W)})})}L();let f;window.addEventListener("resize",()=>{clearTimeout(f),f=window.setTimeout(L,100)}),m.addEventListener("scroll",L),new MutationObserver(()=>{requestAnimationFrame(L)}).observe(m,{childList:!0,subtree:!0})}function n(){let m=document.querySelector(".epic-selector-wrapper");if(!m)return;let M=m.querySelector(".epic-selector"),L=m.querySelector("#epic-nav-left"),f=m.querySelector("#epic-nav-right");if(!M||!L||!f)return;let q=200,H=()=>{let{scrollLeft:J,scrollWidth:j,clientWidth:G}=M;L.disabled=J<=0,f.disabled=J+G>=j-1};L.addEventListener("click",()=>{M.scrollBy({left:-q,behavior:"smooth"})}),f.addEventListener("click",()=>{M.scrollBy({left:q,behavior:"smooth"})}),M.addEventListener("scroll",H),window.addEventListener("resize",H),H()}function b(){n(),g();let m=document.querySelector(".tree-view");if(!m)return;let M=m.querySelector(".tree-list"),L=document.querySelector(".controls-grid")||document.querySelector(".child-expand-controls"),f=new Set,q=()=>m.querySelectorAll(".tree-node"),H=()=>document.querySelectorAll(".type-filter");if(m.getAttribute("data-issue-type")===O.TASK)q().forEach((k)=>{if(k.getAttribute("data-has-children")==="true"){let $=k.getAttribute("data-id");if($){f.add($);let Q=k.querySelector(".tree-toggle");if(Q){Q.classList.add("expanded");let Z=Q.querySelector(".toggle-icon");if(Z)Z.textContent="−"}}}});function j(){let k=H(),E=k.length>0?new Set(Array.from(k).filter(($)=>$.checked).map(($)=>$.value)):null;q().forEach(($)=>{let Q=$.getAttribute("data-parent")||"",Z=$.getAttribute("data-type")||"",y=!1;if(!Q)y=!0;else if(f.has(Q))y=!0;if(y&&E&&!E.has(Z))y=!1;$.classList.toggle("hidden",!y)})}if(M)M.addEventListener("click",(k)=>{let $=k.target.closest(".tree-toggle");if(!$)return;k.preventDefault(),k.stopPropagation();let Q=$.closest(".tree-node");if(!Q)return;let Z=Q.getAttribute("data-id");if(!Z)return;if(f.has(Z)){f.delete(Z),$.classList.remove("expanded");let y=$.querySelector(".toggle-icon");if(y)y.textContent="+"}else{f.add(Z),$.classList.add("expanded");let y=$.querySelector(".toggle-icon");if(y)y.textContent="−"}j()});if(document.addEventListener("change",(k)=>{if(k.target.classList.contains("type-filter"))j()}),L)L.addEventListener("click",(k)=>{let $=k.target.closest("button");if(!$)return;let Q=$.id;if(Q==="expand-all"||Q==="detail-expand")G();else if(Q==="collapse-all"||Q==="detail-collapse")K();else if(Q==="expand-one-level")u();else if(Q==="collapse-one-level")F()});function G(){q().forEach((k)=>{if(k.getAttribute("data-has-children")==="true"){let $=k.getAttribute("data-id");if($){f.add($);let Q=k.querySelector(".tree-toggle");if(Q){Q.classList.add("expanded");let Z=Q.querySelector(".toggle-icon");if(Z)Z.textContent="−"}}}}),j()}function K(){f.clear(),q().forEach((k)=>{let E=k.querySelector(".tree-toggle");if(E){E.classList.remove("expanded");let $=E.querySelector(".toggle-icon");if($)$.textContent="+"}}),j()}function u(){let k=q(),E=-1;k.forEach((Z)=>{let y=Z.getAttribute("data-id");if(y&&f.has(y)){let z=parseInt(Z.getAttribute("data-depth")||"0");if(z>E)E=z}});let $=E+1,Q=[];k.forEach((Z)=>{let y=parseInt(Z.getAttribute("data-depth")||"0"),z=Z.getAttribute("data-id"),X=Z.getAttribute("data-has-children")==="true",D=Z.getAttribute("data-parent");if(z&&X&&!f.has(z)){if(y<=$){if(!D||f.has(D))Q.push({id:z,element:Z})}}}),Q.forEach(({id:Z,element:y})=>{f.add(Z);let z=y.querySelector(".tree-toggle");if(z){z.classList.add("expanded");let X=z.querySelector(".toggle-icon");if(X)X.textContent="−"}}),j()}function F(){let k=q(),E=0;f.forEach(($)=>{k.forEach((Q)=>{if(Q.getAttribute("data-id")===$){let Z=parseInt(Q.getAttribute("data-depth")||"0");E=Math.max(E,Z)}})}),k.forEach(($)=>{let Q=parseInt($.getAttribute("data-depth")||"0"),Z=$.getAttribute("data-id"),y=$.getAttribute("data-has-children")==="true";if(Z&&y&&Q>E-1){f.delete(Z);let z=$.querySelector(".tree-toggle");if(z){z.classList.remove("expanded");let X=z.querySelector(".toggle-icon");if(X)X.textContent="+"}}}),j()}j()}function T(){let m=document.querySelector(".graph-tree-container"),M=document.getElementById("epic-select");if(!m)return;if(M)M.addEventListener("change",()=>{let L=M.value;if(L)window.location.href=`/graph/${L}`;else window.location.href="/graph"});m.addEventListener("click",(L)=>{let f=L.target.closest(".tree-toggle");if(!f)return;let H=f.closest(".tree-node")?.dataset.id;if(!H)return;let J=f.classList.toggle("expanded");h(H,J)})}function h(m,M){document.querySelectorAll(`[data-parent="${m}"]`).forEach((L)=>{if(L.classList.toggle("hidden",!M),!M){let f=L.dataset.id;if(f){let q=L.querySelector(".tree-toggle");if(q?.classList.contains("expanded"))q.classList.remove("expanded"),h(f,!1)}}})}var p=["status","type","priority"];function i(m){return p.includes(m)}function c(){document.addEventListener("click",(m)=>{let L=m.target.closest(".sort-btn");if(!L)return;if(L.classList.contains("active")){d(),L.classList.remove("active");return}let f=L.getAttribute("data-sort");if(f&&i(f))t(f),Mf(L)})}function d(){window.location.reload()}function t(m){let M=document.querySelector(".tree-list");if(!M)return;let L=Array.from(M.querySelectorAll(".tree-node")),f=new Map;L.forEach((H)=>{let J=H.querySelector(".tree-toggle");if(J&&J.classList.contains("expanded"))f.set(H.dataset.id,!0)}),L.sort((H,J)=>o(H,J,m)),M.classList.add("sorting-active"),document.querySelectorAll("#expand-all, #collapse-all, #expand-one-level, #collapse-one-level").forEach((H)=>{H.disabled=!0}),M.innerHTML="",L.forEach((H)=>{if(H.classList.remove("hidden"),M.appendChild(H),f.has(H.dataset.id)){let J=H.querySelector(".tree-toggle");if(J){J.classList.add("expanded");let j=J.querySelector(".toggle-icon");if(j)j.textContent="−"}}})}function o(m,M,L){switch(L){case"status":return e(m.dataset.status,M.dataset.status);case"type":return ff(m.dataset.type,M.dataset.type);case"priority":return mf(m.dataset.priority,M.dataset.priority);default:return 0}}function e(m,M){let L=U[m]??999,f=U[M]??999;return L-f}function ff(m,M){let L=Y[m]??999,f=Y[M]??999;return L-f}function mf(m,M){let L=parseInt(m)||999,f=parseInt(M)||999;return L-f}function Mf(m){document.querySelectorAll(".sort-btn").forEach((L)=>{L.classList.remove("active")}),m.classList.add("active")}document.addEventListener("DOMContentLoaded",()=>{_(),R(),v(),S(),a(),l(),r(),b(),T(),c()});
