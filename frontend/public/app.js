var N=["nacre-light","catppuccin-latte"];(function(){let m=localStorage.getItem("theme"),M=window.matchMedia("(prefers-color-scheme: dark)").matches,L=m||(M?"nacre-dark":"nacre-light");document.documentElement.setAttribute("data-theme",L);let f=N.includes(L)?"light":"dark";document.documentElement.setAttribute("data-syntax",f)})();function P(){let m=document.getElementById("theme-select");if(m){let M=document.documentElement.getAttribute("data-theme")||"nacre-dark";m.value=M,m.addEventListener("change",()=>{let L=m.value;document.documentElement.setAttribute("data-theme",L),localStorage.setItem("theme",L);let f=N.includes(L)?"light":"dark";document.documentElement.setAttribute("data-syntax",f)})}}function Y(){let m=document.getElementById("filter-input");if(m)m.addEventListener("input",(M)=>{let L=M.target.value.toLowerCase();document.querySelectorAll("[data-filter-text]").forEach((q)=>{let H=q.getAttribute("data-filter-text"),r=H&&H.includes(L);if(q instanceof HTMLElement)if(r)q.style.display="";else q.style.display="none"})})}function C(){document.addEventListener("click",(m)=>{let L=m.target.closest(".toggle-children");if(!L)return;let f=L.closest(".epic-item");if(!f)return;let q=f.querySelector(".epic-children");if(!q)return;let H=q.classList.contains("collapsed");if(q.classList.toggle("collapsed"),L.classList.toggle("expanded"),H)q.style.maxHeight=q.scrollHeight+"px",q.style.opacity="1";else q.style.maxHeight="0",q.style.opacity="0"})}class I{container=null;activeToasts=new Set;initialized=!1;constructor(){if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>this.init());else this.init()}init(){if(this.initialized)return;this.container=document.createElement("div"),this.container.id="toast-container",this.container.className="toast-container",document.body.appendChild(this.container),this.initialized=!0}createToast(m){let M=document.createElement("div");M.className=`toast toast-${m.type||"info"}`;let L=document.createElement("div");L.className="toast-message",L.textContent=m.message;let f=document.createElement("div");if(f.className="toast-actions",m.retryAction){let H=document.createElement("button");H.className="toast-retry",H.textContent="Retry",H.addEventListener("click",async()=>{H.disabled=!0,H.textContent="Retrying...";try{await m.retryAction(),this.remove(M),this.show({message:"Success!",type:"success",duration:2000})}catch{H.disabled=!1,H.textContent="Retry"}}),f.appendChild(H)}let q=document.createElement("button");return q.className="toast-close",q.textContent="×",q.addEventListener("click",()=>this.remove(M)),f.appendChild(q),M.appendChild(L),M.appendChild(f),M}show(m){if(!this.initialized)return;if(!this.container)return;let M=this.createToast(m);if(this.container.appendChild(M),this.activeToasts.add(M),setTimeout(()=>{M.classList.add("toast-show")},10),m.duration&&m.duration>0)setTimeout(()=>{this.remove(M)},m.duration)}remove(m){m.classList.remove("toast-show"),setTimeout(()=>{if(m.parentNode)m.parentNode.removeChild(m);this.activeToasts.delete(m)},300)}clear(){this.activeToasts.forEach((m)=>this.remove(m))}}var U=new I;function v(m,M,L){let f=m instanceof Error?m.message:"Unknown error occurred";console.error(`[${M}] ${f}`,m),U.show({message:`${M}: ${f}`,type:"error",duration:L?0:5000,retryAction:L})}function A(m,M,L){let f=`HTTP ${m.status}: ${m.statusText}`;console.error(`[${M}] ${f}`,m),U.show({message:`${M}: ${f}`,type:"error",duration:L?0:5000,retryAction:L})}function _(){document.addEventListener("click",(M)=>{let L=M.target;if(L.classList.contains("issue-title")&&L.closest(".issue-item"))m(L)});function m(M){let L=M.innerText,f=document.createElement("input");f.type="text",f.value=L,f.classList.add("edit-input"),f.addEventListener("click",(j)=>j.stopPropagation()),M.replaceWith(f),f.focus();let q=!1,H=async()=>{if(q)return;q=!0;let j=f.value.trim(),G=f.closest(".issue-item"),$=G?G.getAttribute("data-id"):null;if(j&&j!==L&&$){let u=async()=>{if(!(await fetch(`/api/issues/${$}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:j})})).ok)throw Error("Update failed")};try{await u();let X=document.createElement("div");X.classList.add("issue-title"),X.innerText=j,f.replaceWith(X)}catch(X){if(X instanceof Error&&X.message==="Update failed")A(new Response(null,{status:500,statusText:"Update failed"}),"Failed to update title",u);else v(X,"Failed to update title",u)}}else r()},r=()=>{let j=document.createElement("div");j.classList.add("issue-title"),j.innerText=L,f.replaceWith(j)};f.addEventListener("blur",H),f.addEventListener("keydown",(j)=>{if(j.key==="Enter")f.blur();else if(j.key==="Escape")r(),q=!0})}}var z={OPEN:"open",IN_PROGRESS:"in_progress",BLOCKED:"blocked",CLOSED:"closed",DEFERRED:"deferred"},W={[z.OPEN]:0,[z.IN_PROGRESS]:1,[z.BLOCKED]:2,[z.CLOSED]:3,[z.DEFERRED]:4},y={EPIC:"epic",FEATURE:"feature",BUG:"bug",TASK:"task",CHORE:"chore"},D={[y.EPIC]:0,[y.FEATURE]:1,[y.BUG]:2,[y.TASK]:3,[y.CHORE]:4};var x=Object.values(z);function w(m){return x.includes(m)}function V(){let m=document.getElementById("columns-toggle"),M=document.getElementById("columns-dropdown");if(m&&M){let r=function(G,$){let u=document.querySelector(`.board-column[data-status="${G}"]`);if(u)u.style.display=$?"":"none"},j=function(){let G={};H().forEach(($)=>{let u=$.getAttribute("data-status");if(u&&w(u))G[u]=$.checked}),localStorage.setItem("board-column-visibility",JSON.stringify(G))},f=localStorage.getItem("board-column-visibility"),q=f?JSON.parse(f):null,H=()=>M.querySelectorAll('input[type="checkbox"]');H().forEach((G)=>{let $=G.getAttribute("data-status");if(!$||!w($))return;if(q===null)G.checked=$!==z.DEFERRED;else G.checked=q[$]!==!1;r($,G.checked)}),M.addEventListener("change",(G)=>{let $=G.target;if($.type!=="checkbox")return;let u=$.getAttribute("data-status");if(!u)return;r(u,$.checked),j()}),m.addEventListener("click",(G)=>{G.stopPropagation(),M.classList.toggle("show")}),document.addEventListener("click",(G)=>{if(!M.contains(G.target)&&G.target!==m)M.classList.remove("show")}),M.addEventListener("click",(G)=>{G.stopPropagation()})}let L=()=>{let f=document.querySelectorAll(".type-filter");if(f.length===0)return;let q=new Set(Array.from(f).filter((r)=>r.checked).map((r)=>r.value));document.querySelectorAll(".issue-card").forEach((r)=>{let j=!1;for(let G of q)if(r.classList.contains(`issue-type-${G}`)){j=!0;break}r.classList.toggle("hidden-by-type",!j)})};document.addEventListener("change",(f)=>{if(f.target.classList.contains("type-filter"))L()}),L()}function a(){let m=document.querySelectorAll('.issue-card[draggable="true"]'),M=document.querySelectorAll(".column-content");if(m.length>0&&M.length>0)m.forEach((f)=>{f.addEventListener("dragstart",()=>{f.classList.add("dragging"),f.style.opacity="0.5"}),f.addEventListener("dragend",()=>{f.classList.remove("dragging"),f.style.opacity="1"})}),M.forEach((f)=>{f.addEventListener("dragover",(q)=>{q.preventDefault();let H=document.querySelector(".dragging");if(H){let r=L(f,q.clientY);if(r==null)f.appendChild(H);else f.insertBefore(H,r)}}),f.addEventListener("drop",async()=>{let q=document.querySelector(".dragging");if(!q)return;let H=f.getAttribute("data-status"),r=q.getAttribute("data-id");if(r&&H){let j=async()=>{if(!(await fetch(`/api/issues/${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:H})})).ok)throw Error("Update failed")};try{await j()}catch(G){if(G instanceof Error&&G.message==="Update failed")A(new Response(null,{status:500,statusText:"Update failed"}),"Failed to update status",j);else v(G,"Failed to update status",j)}}})});function L(f,q){return[...f.querySelectorAll(".issue-card:not(.dragging)")].reduce((j,G)=>{let $=G.getBoundingClientRect(),u=q-$.top-$.height/2;if(u<0&&u>j.offset)return{offset:u,element:G};else return j},{offset:Number.NEGATIVE_INFINITY,element:null}).element}}function l(){let m=-1,M=0,L=0,f=document.querySelector(".board")!==null,q=document.querySelector(".issue-list")!==null;if(f)$();document.addEventListener("keydown",(u)=>{let X=u.target;if(X.tagName==="INPUT"||X.tagName==="TEXTAREA")return;if(u.key==="Backspace"){u.preventDefault(),window.history.back();return}if(q)H(u);else if(f)r(u)});function H(u){let X=Array.from(document.querySelectorAll('.issue-item:not([style*="display: none"])'));if(X.length===0)return;let k=document.querySelector(".issue-item.selected");if(k)m=X.indexOf(k);if(u.key==="j"||u.key==="ArrowDown"){m=Math.min(m+1,X.length-1);let E=X.at(m);if(E)G(E);u.preventDefault()}else if(u.key==="k"||u.key==="ArrowUp"){m=Math.max(m-1,0);let E=X.at(m);if(E)G(E);u.preventDefault()}else if(u.key==="Enter"||u.key==="o"){if(k){let E=k.querySelector(".issue-meta a");if(E)E.click()}}}function r(u){let X=Array.from(document.querySelectorAll('.board-column:not([style*="display: none"])'));if(X.length===0)return;if(u.key==="j"||u.key==="ArrowDown"){let k=X.at(M);if(!k)return;let E=j(k);if(E.length>0)L=Math.min(L+1,E.length-1),$(),u.preventDefault()}else if(u.key==="k"||u.key==="ArrowUp")L=Math.max(L-1,0),$(),u.preventDefault();else if(u.key==="h"||u.key==="ArrowLeft"){M=Math.max(M-1,0);let k=X.at(M);if(!k)return;let E=j(k);L=Math.min(L,Math.max(0,E.length-1)),$(),u.preventDefault()}else if(u.key==="l"||u.key==="ArrowRight"){M=Math.min(M+1,X.length-1);let k=X.at(M);if(!k)return;let E=j(k);L=Math.min(L,Math.max(0,E.length-1)),$(),u.preventDefault()}else if(u.key==="Enter"||u.key==="o"){let k=document.querySelector(".issue-card.selected");if(k){let E=k.querySelector("a");if(E)E.click()}}}function j(u){if(!u)return[];return Array.from(u.querySelectorAll('.issue-card:not([style*="display: none"])'))}function G(u){if(document.querySelectorAll(".issue-item.selected").forEach((X)=>X.classList.remove("selected")),u)u.classList.add("selected"),u.scrollIntoView({behavior:"smooth",block:"nearest"})}function $(){let u=Array.from(document.querySelectorAll('.board-column:not([style*="display: none"])'));if(u.length===0)return;M=Math.max(0,Math.min(M,u.length-1));let X=u.at(M);if(!X)return;let k=j(X);if(document.querySelectorAll(".issue-card.selected").forEach((E)=>E.classList.remove("selected")),k.length>0){L=Math.max(0,Math.min(L,k.length-1));let E=k.at(L);if(E)E.classList.add("selected"),E.scrollIntoView({behavior:"smooth",block:"nearest"})}}}function b(){let m=document.querySelector(".epic-selector-wrapper");if(!m)return;let M=m.querySelector(".epic-selector"),L=m.querySelector("#epic-nav-left"),f=m.querySelector("#epic-nav-right");if(!M||!L||!f)return;let q=200,H=()=>{let{scrollLeft:r,scrollWidth:j,clientWidth:G}=M;L.disabled=r<=0,f.disabled=r+G>=j-1};L.addEventListener("click",()=>{M.scrollBy({left:-q,behavior:"smooth"})}),f.addEventListener("click",()=>{M.scrollBy({left:q,behavior:"smooth"})}),M.addEventListener("scroll",H),window.addEventListener("resize",H),H()}function c(){b();let m=document.querySelector(".tree-view");if(!m)return;let M=m.querySelector(".tree-list"),L=document.querySelector(".controls-grid")||document.querySelector(".child-expand-controls"),f=new Set,q=()=>m.querySelectorAll(".tree-node"),H=()=>document.querySelectorAll(".type-filter");if(m.getAttribute("data-issue-type")===y.TASK)q().forEach((k)=>{if(k.getAttribute("data-has-children")==="true"){let J=k.getAttribute("data-id");if(J){f.add(J);let F=k.querySelector(".tree-toggle");if(F){F.classList.add("expanded");let K=F.querySelector(".toggle-icon");if(K)K.textContent="−"}}}});function j(){let k=H(),E=k.length>0?new Set(Array.from(k).filter((J)=>J.checked).map((J)=>J.value)):null;q().forEach((J)=>{let F=J.getAttribute("data-parent")||"",K=J.getAttribute("data-type")||"",Q=!1;if(!F)Q=!0;else if(f.has(F))Q=!0;if(Q&&E&&!E.has(K))Q=!1;J.classList.toggle("hidden",!Q)})}if(M)M.addEventListener("click",(k)=>{let J=k.target.closest(".tree-toggle");if(!J)return;k.preventDefault(),k.stopPropagation();let F=J.closest(".tree-node");if(!F)return;let K=F.getAttribute("data-id");if(!K)return;if(f.has(K)){f.delete(K),J.classList.remove("expanded");let Q=J.querySelector(".toggle-icon");if(Q)Q.textContent="+"}else{f.add(K),J.classList.add("expanded");let Q=J.querySelector(".toggle-icon");if(Q)Q.textContent="−"}j()});if(document.addEventListener("change",(k)=>{if(k.target.classList.contains("type-filter"))j()}),L)L.addEventListener("click",(k)=>{let J=k.target.closest("button");if(!J)return;let F=J.id;if(F==="expand-all"||F==="detail-expand")G();else if(F==="collapse-all"||F==="detail-collapse")$();else if(F==="expand-one-level")u();else if(F==="collapse-one-level")X()});function G(){q().forEach((k)=>{if(k.getAttribute("data-has-children")==="true"){let J=k.getAttribute("data-id");if(J){f.add(J);let F=k.querySelector(".tree-toggle");if(F){F.classList.add("expanded");let K=F.querySelector(".toggle-icon");if(K)K.textContent="−"}}}}),j()}function $(){f.clear(),q().forEach((k)=>{let E=k.querySelector(".tree-toggle");if(E){E.classList.remove("expanded");let J=E.querySelector(".toggle-icon");if(J)J.textContent="+"}}),j()}function u(){let k=q(),E=-1;k.forEach((K)=>{let Q=K.getAttribute("data-id");if(Q&&f.has(Q)){let Z=parseInt(K.getAttribute("data-depth")||"0");if(Z>E)E=Z}});let J=E+1,F=[];k.forEach((K)=>{let Q=parseInt(K.getAttribute("data-depth")||"0"),Z=K.getAttribute("data-id"),O=K.getAttribute("data-has-children")==="true",R=K.getAttribute("data-parent");if(Z&&O&&!f.has(Z)){if(Q<=J){if(!R||f.has(R))F.push({id:Z,element:K})}}}),F.forEach(({id:K,element:Q})=>{f.add(K);let Z=Q.querySelector(".tree-toggle");if(Z){Z.classList.add("expanded");let O=Z.querySelector(".toggle-icon");if(O)O.textContent="−"}}),j()}function X(){let k=q(),E=0;f.forEach((J)=>{k.forEach((F)=>{if(F.getAttribute("data-id")===J){let K=parseInt(F.getAttribute("data-depth")||"0");E=Math.max(E,K)}})}),k.forEach((J)=>{let F=parseInt(J.getAttribute("data-depth")||"0"),K=J.getAttribute("data-id"),Q=J.getAttribute("data-has-children")==="true";if(K&&Q&&F>E-1){f.delete(K);let Z=J.querySelector(".tree-toggle");if(Z){Z.classList.remove("expanded");let O=Z.querySelector(".toggle-icon");if(O)O.textContent="+"}}}),j()}j()}function h(){let m=document.querySelector(".graph-tree-container"),M=document.getElementById("epic-select");if(!m)return;if(M)M.addEventListener("change",()=>{let L=M.value;if(L)window.location.href=`/graph/${L}`;else window.location.href="/graph"});m.addEventListener("click",(L)=>{let f=L.target.closest(".tree-toggle");if(!f)return;let H=f.closest(".tree-node")?.dataset.id;if(!H)return;let r=f.classList.toggle("expanded");S(H,r)})}function S(m,M){document.querySelectorAll(`[data-parent="${m}"]`).forEach((L)=>{if(L.classList.toggle("hidden",!M),!M){let f=L.dataset.id;if(f){let q=L.querySelector(".tree-toggle");if(q?.classList.contains("expanded"))q.classList.remove("expanded"),S(f,!1)}}})}var s=["status","type","priority"];function B(m){return s.includes(m)}function T(){document.addEventListener("click",(m)=>{let L=m.target.closest(".sort-btn");if(!L)return;if(L.classList.contains("active")){g(),L.classList.remove("active");return}let f=L.getAttribute("data-sort");if(f&&B(f))n(f),o(L)})}function g(){window.location.reload()}function n(m){let M=document.querySelector(".tree-list");if(!M)return;let L=Array.from(M.querySelectorAll(".tree-node")),f=new Map;L.forEach((H)=>{let r=H.querySelector(".tree-toggle");if(r&&r.classList.contains("expanded"))f.set(H.dataset.id,!0)}),L.sort((H,r)=>p(H,r,m)),M.classList.add("sorting-active"),document.querySelectorAll("#expand-all, #collapse-all, #expand-one-level, #collapse-one-level").forEach((H)=>{H.disabled=!0}),M.innerHTML="",L.forEach((H)=>{if(H.classList.remove("hidden"),M.appendChild(H),f.has(H.dataset.id)){let r=H.querySelector(".tree-toggle");if(r){r.classList.add("expanded");let j=r.querySelector(".toggle-icon");if(j)j.textContent="−"}}})}function p(m,M,L){switch(L){case"status":return i(m.dataset.status,M.dataset.status);case"type":return t(m.dataset.type,M.dataset.type);case"priority":return d(m.dataset.priority,M.dataset.priority);default:return 0}}function i(m,M){let L=W[m]??999,f=W[M]??999;return L-f}function t(m,M){let L=D[m]??999,f=D[M]??999;return L-f}function d(m,M){let L=parseInt(m)||999,f=parseInt(M)||999;return L-f}function o(m){document.querySelectorAll(".sort-btn").forEach((L)=>{L.classList.remove("active")}),m.classList.add("active")}document.addEventListener("DOMContentLoaded",()=>{P(),Y(),C(),_(),V(),a(),l(),c(),h(),T()});
