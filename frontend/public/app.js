var w=["nacre-light","catppuccin-latte"];(function(){let m=localStorage.getItem("theme"),M=window.matchMedia("(prefers-color-scheme: dark)").matches,L=m||(M?"nacre-dark":"nacre-light");document.documentElement.setAttribute("data-theme",L);let f=w.includes(L)?"light":"dark";document.documentElement.setAttribute("data-syntax",f)})();function N(){let m=document.getElementById("theme-select");if(m){let M=document.documentElement.getAttribute("data-theme")||"nacre-dark";m.value=M,m.addEventListener("change",()=>{let L=m.value;document.documentElement.setAttribute("data-theme",L),localStorage.setItem("theme",L);let f=w.includes(L)?"light":"dark";document.documentElement.setAttribute("data-syntax",f)})}}function V(){let m=document.getElementById("filter-input");if(m)m.addEventListener("input",(M)=>{let L=M.target.value.toLowerCase();document.querySelectorAll("[data-filter-text]").forEach((H)=>{let k=H.getAttribute("data-filter-text"),J=k&&k.includes(L);if(H instanceof HTMLElement)if(J)H.style.display="";else H.style.display="none"})})}function S(){document.addEventListener("click",(m)=>{let L=m.target.closest(".toggle-children");if(!L)return;let f=L.closest(".epic-item");if(!f)return;let H=f.querySelector(".epic-children");if(!H)return;let k=H.classList.contains("collapsed");if(H.classList.toggle("collapsed"),L.classList.toggle("expanded"),k)H.style.maxHeight=H.scrollHeight+"px",H.style.opacity="1";else H.style.maxHeight="0",H.style.opacity="0"})}class x{container=null;activeToasts=new Set;initialized=!1;constructor(){if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>this.init());else this.init()}init(){if(this.initialized)return;this.container=document.createElement("div"),this.container.id="toast-container",this.container.className="toast-container",document.body.appendChild(this.container),this.initialized=!0}createToast(m){let M=document.createElement("div");M.className=`toast toast-${m.type||"info"}`;let L=document.createElement("div");L.className="toast-message",L.textContent=m.message;let f=document.createElement("div");if(f.className="toast-actions",m.retryAction){let k=document.createElement("button");k.className="toast-retry",k.textContent="Retry",k.addEventListener("click",async()=>{k.disabled=!0,k.textContent="Retrying...";try{await m.retryAction(),this.remove(M),this.show({message:"Success!",type:"success",duration:2000})}catch{k.disabled=!1,k.textContent="Retry"}}),f.appendChild(k)}let H=document.createElement("button");return H.className="toast-close",H.textContent="×",H.addEventListener("click",()=>this.remove(M)),f.appendChild(H),M.appendChild(L),M.appendChild(f),M}show(m){if(!this.initialized)return;if(!this.container)return;let M=this.createToast(m);if(this.container.appendChild(M),this.activeToasts.add(M),setTimeout(()=>{M.classList.add("toast-show")},10),m.duration&&m.duration>0)setTimeout(()=>{this.remove(M)},m.duration)}remove(m){m.classList.remove("toast-show"),setTimeout(()=>{if(m.parentNode)m.parentNode.removeChild(m);this.activeToasts.delete(m)},300)}clear(){this.activeToasts.forEach((m)=>this.remove(m))}}var b=new x;function P(m,M,L){let f=m instanceof Error?m.message:"Unknown error occurred";console.error(`[${M}] ${f}`,m),b.show({message:`${M}: ${f}`,type:"error",duration:L?0:5000,retryAction:L})}function U(m,M,L){let f=`HTTP ${m.status}: ${m.statusText}`;console.error(`[${M}] ${f}`,m),b.show({message:`${M}: ${f}`,type:"error",duration:L?0:5000,retryAction:L})}function T(){document.addEventListener("click",(M)=>{let L=M.target;if(L.classList.contains("issue-title")&&L.closest(".issue-item"))m(L)});function m(M){let L=M.innerText,f=document.createElement("input");f.type="text",f.value=L,f.classList.add("edit-input"),f.addEventListener("click",(E)=>E.stopPropagation()),M.replaceWith(f),f.focus();let H=!1,k=async()=>{if(H)return;H=!0;let E=f.value.trim(),G=f.closest(".issue-item"),Q=G?G.getAttribute("data-id"):null;if(E&&E!==L&&Q){let u=async()=>{if(!(await fetch(`/api/issues/${Q}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:E})})).ok)throw Error("Update failed")};try{await u();let F=document.createElement("div");F.classList.add("issue-title"),F.innerText=E,f.replaceWith(F)}catch(F){if(F instanceof Error&&F.message==="Update failed")U(new Response(null,{status:500,statusText:"Update failed"}),"Failed to update title",u);else P(F,"Failed to update title",u)}}else J()},J=()=>{let E=document.createElement("div");E.classList.add("issue-title"),E.innerText=L,f.replaceWith(E)};f.addEventListener("blur",k),f.addEventListener("keydown",(E)=>{if(E.key==="Enter")f.blur();else if(E.key==="Escape")J(),H=!0})}}var W={OPEN:"open",IN_PROGRESS:"in_progress",BLOCKED:"blocked",CLOSED:"closed",DEFERRED:"deferred"},Y={[W.OPEN]:0,[W.IN_PROGRESS]:1,[W.BLOCKED]:2,[W.CLOSED]:3,[W.DEFERRED]:4},D={EPIC:"epic",FEATURE:"feature",BUG:"bug",TASK:"task",CHORE:"chore"},_={[D.EPIC]:0,[D.FEATURE]:1,[D.BUG]:2,[D.TASK]:3,[D.CHORE]:4};var p=Object.values(W);function l(m){return p.includes(m)}function r(){let m=document.getElementById("columns-toggle"),M=document.getElementById("columns-dropdown");if(m&&M){let J=function(G,Q){let u=document.querySelector(`.board-column[data-status="${G}"]`);if(u)u.style.display=Q?"":"none"},E=function(){let G={};k().forEach((Q)=>{let u=Q.getAttribute("data-status");if(u&&l(u))G[u]=Q.checked}),localStorage.setItem("board-column-visibility",JSON.stringify(G))},f=localStorage.getItem("board-column-visibility"),H=f?JSON.parse(f):null,k=()=>M.querySelectorAll('input[type="checkbox"]');k().forEach((G)=>{let Q=G.getAttribute("data-status");if(!Q||!l(Q))return;if(H===null)G.checked=Q!==W.DEFERRED;else G.checked=H[Q]!==!1;J(Q,G.checked)}),M.addEventListener("change",(G)=>{let Q=G.target;if(Q.type!=="checkbox")return;let u=Q.getAttribute("data-status");if(!u)return;J(u,Q.checked),E()}),m.addEventListener("click",(G)=>{G.stopPropagation(),M.classList.toggle("show")}),document.addEventListener("click",(G)=>{if(!M.contains(G.target)&&G.target!==m)M.classList.remove("show")}),M.addEventListener("click",(G)=>{G.stopPropagation()})}let L=()=>{let f=document.querySelectorAll(".type-filter");if(f.length===0)return;let H=new Set(Array.from(f).filter((J)=>J.checked).map((J)=>J.value));document.querySelectorAll(".issue-card").forEach((J)=>{let E=!1;for(let G of H)if(J.classList.contains(`issue-type-${G}`)){E=!0;break}J.classList.toggle("hidden-by-type",!E)})};document.addEventListener("change",(f)=>{if(f.target.classList.contains("type-filter"))L()}),L()}function B(){let m=document.querySelectorAll('.issue-card[draggable="true"]'),M=document.querySelectorAll(".column-content");if(m.length>0&&M.length>0)m.forEach((f)=>{f.addEventListener("dragstart",()=>{f.classList.add("dragging"),f.style.opacity="0.5"}),f.addEventListener("dragend",()=>{f.classList.remove("dragging"),f.style.opacity="1"})}),M.forEach((f)=>{f.addEventListener("dragover",(H)=>{H.preventDefault();let k=document.querySelector(".dragging");if(k){let J=L(f,H.clientY);if(J==null)f.appendChild(k);else f.insertBefore(k,J)}}),f.addEventListener("drop",async()=>{let H=document.querySelector(".dragging");if(!H)return;let k=f.getAttribute("data-status"),J=H.getAttribute("data-id");if(J&&k){let E=async()=>{if(!(await fetch(`/api/issues/${J}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:k})})).ok)throw Error("Update failed")};try{await E()}catch(G){if(G instanceof Error&&G.message==="Update failed")U(new Response(null,{status:500,statusText:"Update failed"}),"Failed to update status",E);else P(G,"Failed to update status",E)}}})});function L(f,H){return[...f.querySelectorAll(".issue-card:not(.dragging)")].reduce((E,G)=>{let Q=G.getBoundingClientRect(),u=H-Q.top-Q.height/2;if(u<0&&u>E.offset)return{offset:u,element:G};else return E},{offset:Number.NEGATIVE_INFINITY,element:null}).element}}function c(){let m=-1,M=0,L=0,f=document.querySelector(".board")!==null,H=document.querySelector(".issue-list")!==null;if(f)Q();document.addEventListener("keydown",(u)=>{let F=u.target;if(F.tagName==="INPUT"||F.tagName==="TEXTAREA")return;if(u.key==="Backspace"){u.preventDefault(),window.history.back();return}if(H)k(u);else if(f)J(u)});function k(u){let F=Array.from(document.querySelectorAll('.issue-item:not([style*="display: none"])'));if(F.length===0)return;let q=document.querySelector(".issue-item.selected");if(q)m=F.indexOf(q);if(u.key==="j"||u.key==="ArrowDown"){m=Math.min(m+1,F.length-1);let j=F.at(m);if(j)G(j);u.preventDefault()}else if(u.key==="k"||u.key==="ArrowUp"){m=Math.max(m-1,0);let j=F.at(m);if(j)G(j);u.preventDefault()}else if(u.key==="Enter"||u.key==="o"){if(q){let j=q.querySelector(".issue-meta a");if(j)j.click()}}}function J(u){let F=Array.from(document.querySelectorAll('.board-column:not([style*="display: none"])'));if(F.length===0)return;if(u.key==="j"||u.key==="ArrowDown"){let q=F.at(M);if(!q)return;let j=E(q);if(j.length>0)L=Math.min(L+1,j.length-1),Q(),u.preventDefault()}else if(u.key==="k"||u.key==="ArrowUp")L=Math.max(L-1,0),Q(),u.preventDefault();else if(u.key==="h"||u.key==="ArrowLeft"){M=Math.max(M-1,0);let q=F.at(M);if(!q)return;let j=E(q);L=Math.min(L,Math.max(0,j.length-1)),Q(),u.preventDefault()}else if(u.key==="l"||u.key==="ArrowRight"){M=Math.min(M+1,F.length-1);let q=F.at(M);if(!q)return;let j=E(q);L=Math.min(L,Math.max(0,j.length-1)),Q(),u.preventDefault()}else if(u.key==="Enter"||u.key==="o"){let q=document.querySelector(".issue-card.selected");if(q){let j=q.querySelector("a");if(j)j.click()}}}function E(u){if(!u)return[];return Array.from(u.querySelectorAll('.issue-card:not([style*="display: none"])'))}function G(u){if(document.querySelectorAll(".issue-item.selected").forEach((F)=>F.classList.remove("selected")),u)u.classList.add("selected"),u.scrollIntoView({behavior:"smooth",block:"nearest"})}function Q(){let u=Array.from(document.querySelectorAll('.board-column:not([style*="display: none"])'));if(u.length===0)return;M=Math.max(0,Math.min(M,u.length-1));let F=u.at(M);if(!F)return;let q=E(F);if(document.querySelectorAll(".issue-card.selected").forEach((j)=>j.classList.remove("selected")),q.length>0){L=Math.max(0,Math.min(L,q.length-1));let j=q.at(L);if(j)j.classList.add("selected"),j.scrollIntoView({behavior:"smooth",block:"nearest"})}}}function i(){let m=document.querySelector(".org-tree");if(!m)return;let M=m.querySelector(".org-tree-svg");if(!M)M=document.createElementNS("http://www.w3.org/2000/svg","svg"),M.classList.add("org-tree-svg"),M.style.position="absolute",M.style.top="0",M.style.left="0",M.style.width="100%",M.style.height="100%",M.style.pointerEvents="none",M.style.overflow="visible",m.style.position="relative",m.insertBefore(M,m.firstChild);let L=new Map;function f(){M.innerHTML="",L.clear();let G=getComputedStyle(document.documentElement).getPropertyValue("--border-color").trim()||"#585b70";m.querySelectorAll("li").forEach((u)=>{let F=u.querySelector(":scope > a.org-node, :scope > .org-node"),q=u.querySelector(":scope > ul");if(!F||!q)return;let j=q.querySelectorAll(":scope > li");if(j.length===0)return;let $=F.getBoundingClientRect(),K=m.getBoundingClientRect(),Z=$.left+$.width/2-K.left,z=$.bottom-K.top,X=[];j.forEach((A)=>{let y=A.querySelector(":scope > a.org-node, :scope > .org-node");if(!y)return;let I=y.getBoundingClientRect(),C=I.left+I.width/2-K.left,R=I.top-K.top,v=(z+R)/2,O=document.createElementNS("http://www.w3.org/2000/svg","path"),n=`M ${Z} ${z} C ${Z} ${v}, ${C} ${v}, ${C} ${R}`;O.setAttribute("d",n),O.setAttribute("fill","none"),O.setAttribute("stroke",G),O.setAttribute("stroke-width","2"),O.setAttribute("stroke-linecap","round"),O.style.transition="stroke 0.2s ease, stroke-width 0.2s ease",M.appendChild(O),X.push({path:O,childNode:y})}),L.set(F,X)}),H()}function H(){let E=getComputedStyle(document.documentElement),G=E.getPropertyValue("--accent").trim()||"#fab387",Q=E.getPropertyValue("--border-color").trim()||"#585b70";L.forEach((u,F)=>{F.addEventListener("mouseenter",()=>{u.forEach(({path:q,childNode:j})=>{q.setAttribute("stroke",G),q.setAttribute("stroke-width","3"),j.classList.add("org-node-highlight")})}),F.addEventListener("mouseleave",()=>{u.forEach(({path:q,childNode:j})=>{q.setAttribute("stroke",Q),q.setAttribute("stroke-width","2"),j.classList.remove("org-node-highlight")})})})}f();let k;window.addEventListener("resize",()=>{clearTimeout(k),k=window.setTimeout(f,100)}),m.addEventListener("scroll",f),new MutationObserver(()=>{requestAnimationFrame(f)}).observe(m,{childList:!0,subtree:!0})}function d(){let m=document.querySelector(".epic-selector-wrapper");if(!m)return;let M=m.querySelector(".epic-selector"),L=m.querySelector("#epic-nav-left"),f=m.querySelector("#epic-nav-right");if(!M||!L||!f)return;let H=200,k=()=>{let{scrollLeft:J,scrollWidth:E,clientWidth:G}=M;L.disabled=J<=0,f.disabled=J+G>=E-1};L.addEventListener("click",()=>{M.scrollBy({left:-H,behavior:"smooth"})}),f.addEventListener("click",()=>{M.scrollBy({left:H,behavior:"smooth"})}),M.addEventListener("scroll",k),window.addEventListener("resize",k),k()}function a(){d(),i();let m=document.querySelector(".tree-view");if(!m)return;let M=m.querySelector(".tree-list"),L=document.querySelector(".controls-grid")||document.querySelector(".child-expand-controls"),f=new Set,H=()=>m.querySelectorAll(".tree-node"),k=()=>document.querySelectorAll(".type-filter");if(m.getAttribute("data-issue-type")===D.TASK)H().forEach((q)=>{if(q.getAttribute("data-has-children")==="true"){let $=q.getAttribute("data-id");if($){f.add($);let K=q.querySelector(".tree-toggle");if(K){K.classList.add("expanded");let Z=K.querySelector(".toggle-icon");if(Z)Z.textContent="−"}}}});function E(){let q=k(),j=q.length>0?new Set(Array.from(q).filter(($)=>$.checked).map(($)=>$.value)):null;H().forEach(($)=>{let K=$.getAttribute("data-parent")||"",Z=$.getAttribute("data-type")||"",z=!1;if(!K)z=!0;else if(f.has(K))z=!0;if(z&&j&&!j.has(Z))z=!1;$.classList.toggle("hidden",!z)})}if(M)M.addEventListener("click",(q)=>{let $=q.target.closest(".tree-toggle");if(!$)return;q.preventDefault(),q.stopPropagation();let K=$.closest(".tree-node");if(!K)return;let Z=K.getAttribute("data-id");if(!Z)return;if(f.has(Z)){f.delete(Z),$.classList.remove("expanded");let z=$.querySelector(".toggle-icon");if(z)z.textContent="+"}else{f.add(Z),$.classList.add("expanded");let z=$.querySelector(".toggle-icon");if(z)z.textContent="−"}E()});if(document.addEventListener("change",(q)=>{if(q.target.classList.contains("type-filter"))E()}),L)L.addEventListener("click",(q)=>{let $=q.target.closest("button");if(!$)return;let K=$.id;if(K==="expand-all"||K==="detail-expand")G();else if(K==="collapse-all"||K==="detail-collapse")Q();else if(K==="expand-one-level")u();else if(K==="collapse-one-level")F()});function G(){H().forEach((q)=>{if(q.getAttribute("data-has-children")==="true"){let $=q.getAttribute("data-id");if($){f.add($);let K=q.querySelector(".tree-toggle");if(K){K.classList.add("expanded");let Z=K.querySelector(".toggle-icon");if(Z)Z.textContent="−"}}}}),E()}function Q(){f.clear(),H().forEach((q)=>{let j=q.querySelector(".tree-toggle");if(j){j.classList.remove("expanded");let $=j.querySelector(".toggle-icon");if($)$.textContent="+"}}),E()}function u(){let q=H(),j=-1;q.forEach((Z)=>{let z=Z.getAttribute("data-id");if(z&&f.has(z)){let X=parseInt(Z.getAttribute("data-depth")||"0");if(X>j)j=X}});let $=j+1,K=[];q.forEach((Z)=>{let z=parseInt(Z.getAttribute("data-depth")||"0"),X=Z.getAttribute("data-id"),A=Z.getAttribute("data-has-children")==="true",y=Z.getAttribute("data-parent");if(X&&A&&!f.has(X)){if(z<=$){if(!y||f.has(y))K.push({id:X,element:Z})}}}),K.forEach(({id:Z,element:z})=>{f.add(Z);let X=z.querySelector(".tree-toggle");if(X){X.classList.add("expanded");let A=X.querySelector(".toggle-icon");if(A)A.textContent="−"}}),E()}function F(){let q=H(),j=0;f.forEach(($)=>{q.forEach((K)=>{if(K.getAttribute("data-id")===$){let Z=parseInt(K.getAttribute("data-depth")||"0");j=Math.max(j,Z)}})}),q.forEach(($)=>{let K=parseInt($.getAttribute("data-depth")||"0"),Z=$.getAttribute("data-id"),z=$.getAttribute("data-has-children")==="true";if(Z&&z&&K>j-1){f.delete(Z);let X=$.querySelector(".tree-toggle");if(X){X.classList.remove("expanded");let A=X.querySelector(".toggle-icon");if(A)A.textContent="+"}}}),E()}E()}function h(){let m=document.querySelector(".graph-tree-container"),M=document.getElementById("epic-select");if(!m)return;if(M)M.addEventListener("change",()=>{let L=M.value;if(L)window.location.href=`/graph/${L}`;else window.location.href="/graph"});m.addEventListener("click",(L)=>{let f=L.target.closest(".tree-toggle");if(!f)return;let k=f.closest(".tree-node")?.dataset.id;if(!k)return;let J=f.classList.toggle("expanded");s(k,J)})}function s(m,M){document.querySelectorAll(`[data-parent="${m}"]`).forEach((L)=>{if(L.classList.toggle("hidden",!M),!M){let f=L.dataset.id;if(f){let H=L.querySelector(".tree-toggle");if(H?.classList.contains("expanded"))H.classList.remove("expanded"),s(f,!1)}}})}var o=["status","type","priority"];function t(m){return o.includes(m)}function g(){document.addEventListener("click",(m)=>{let L=m.target.closest(".sort-btn");if(!L)return;if(L.classList.contains("active")){e(),L.classList.remove("active");return}let f=L.getAttribute("data-sort");if(f&&t(f))ff(f),qf(L)})}function e(){window.location.reload()}function ff(m){let M=document.querySelector(".tree-list");if(!M)return;let L=Array.from(M.querySelectorAll(".tree-node")),f=new Map;L.forEach((k)=>{let J=k.querySelector(".tree-toggle");if(J&&J.classList.contains("expanded"))f.set(k.dataset.id,!0)}),L.sort((k,J)=>mf(k,J,m)),M.classList.add("sorting-active"),document.querySelectorAll("#expand-all, #collapse-all, #expand-one-level, #collapse-one-level").forEach((k)=>{k.disabled=!0}),M.innerHTML="",L.forEach((k)=>{if(k.classList.remove("hidden"),M.appendChild(k),f.has(k.dataset.id)){let J=k.querySelector(".tree-toggle");if(J){J.classList.add("expanded");let E=J.querySelector(".toggle-icon");if(E)E.textContent="−"}}})}function mf(m,M,L){switch(L){case"status":return Mf(m.dataset.status,M.dataset.status);case"type":return Lf(m.dataset.type,M.dataset.type);case"priority":return uf(m.dataset.priority,M.dataset.priority);default:return 0}}function Mf(m,M){let L=Y[m]??999,f=Y[M]??999;return L-f}function Lf(m,M){let L=_[m]??999,f=_[M]??999;return L-f}function uf(m,M){let L=parseInt(m)||999,f=parseInt(M)||999;return L-f}function qf(m){document.querySelectorAll(".sort-btn").forEach((L)=>{L.classList.remove("active")}),m.classList.add("active")}document.addEventListener("DOMContentLoaded",()=>{N(),V(),S(),T(),r(),B(),c(),a(),h(),g()});
