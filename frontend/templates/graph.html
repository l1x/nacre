<!DOCTYPE html>
<html lang="en">
<head>
    {% include "_head.html" %}
</head>
<body>
    {% include "_header.html" %}
    <main id="content">
        <div class="graph-page">
            <div class="graph-header">
                <h2>Dependency Graph</h2>
                <div class="graph-controls">
                    <label for="epic-select">Epic:</label>
                    <select id="epic-select" class="graph-select">
                        <option value="">Select an epic...</option>
                        {% for epic in epics %}
                        <option value="{{ epic.id }}"{% if epic.selected %} selected{% endif %}>
                            {{ epic.id }}: {{ epic.title }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="graph-tree-view">
                {% if tree.is_empty() %}
                <div class="graph-empty-state">Select an epic to view its dependency tree</div>
                {% else %}
                <ul class="tree-list">
                    {% for node in tree %}
                    <li class="tree-node{% if node.depth > 0 %} hidden{% endif %}"
                        data-id="{{ node.id }}"
                        data-depth="{{ node.depth }}"
                        data-type="{{ node.issue_type }}"
                        data-status="{{ node.status }}"
                        data-priority="{{ node.priority }}"
                        data-parent="{% if let Some(p) = node.parent_id %}{{ p }}{% endif %}"
                        data-has-children="{{ node.has_children }}"
                        style="--depth: {{ node.depth }}">
                        <div class="tree-node-content">
                            {% if node.has_children %}
                            <button class="tree-toggle" aria-label="Toggle children">
                                <span class="toggle-icon">+</span>
                            </button>
                            {% else %}
                            <span class="tree-toggle-placeholder"></span>
                            {% endif %}
                            <span class="tree-status status-{{ node.status }}"></span>
                            <span class="tree-type type-{{ node.issue_type }}">{{ node.issue_type }}</span>
                            <a href="/tasks/{{ node.id }}" class="tree-title">{{ node.title }}</a>
                            <span class="tree-id">{{ node.id }}</span>
                            <span class="tree-priority">P{{ node.priority }}</span>
                            {% if node.blocked_by_count > 0 %}
                            <span class="tree-blocked" title="Blocked by {{ node.blocked_by_count }} issue(s)">
                                blocked
                            </span>
                            {% endif %}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="graph-legend">
                <h3>Legend</h3>
                <div class="legend-section">
                    <h4>Status</h4>
                    <div class="legend-items">
                        <div class="legend-item"><span class="legend-color status-open"></span> Open</div>
                        <div class="legend-item"><span class="legend-color status-in_progress"></span> In Progress</div>
                        <div class="legend-item"><span class="legend-color status-blocked"></span> Blocked</div>
                        <div class="legend-item"><span class="legend-color status-closed"></span> Closed</div>
                    </div>
                </div>
                <div class="legend-section">
                    <h4>Type</h4>
                    <div class="legend-items">
                        <div class="legend-item"><span class="legend-color type-epic"></span> Epic</div>
                        <div class="legend-item"><span class="legend-color type-feature"></span> Feature</div>
                        <div class="legend-item"><span class="legend-color type-task"></span> Task</div>
                        <div class="legend-item"><span class="legend-color type-bug"></span> Bug</div>
                    </div>
                </div>
            </div>
        </div>
    </main>
{% include "_footer.html" %}
</body>
</html>
