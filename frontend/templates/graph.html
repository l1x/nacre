<!DOCTYPE html>
<html lang="en">
<head>
    {% include "_head.html" %}
</head>
<body>
    {% include "_header.html" %}
    <main id="content">
        <div class="graph-page">
            <div class="epic-selector-wrapper">
                <button class="epic-nav epic-nav--left" id="epic-nav-left" aria-label="Previous epics">&larr;</button>
                <div class="epic-selector" id="epic-selector">
                    {% for epic in epics %}
                    <a href="/graph/{{ epic.id }}{% if include_closed %}?include_closed=true{% endif %}" class="epic-pill{% if epic.selected %} epic-pill--active{% endif %}" title="{{ epic.title }}">
                        {{ epic.id }}
                    </a>
                    {% endfor %}
                </div>
                <button class="epic-nav epic-nav--right" id="epic-nav-right" aria-label="Next epics">&rarr;</button>
                <label class="include-closed-toggle">
                    <input type="checkbox" id="include-closed" {% if include_closed %}checked{% endif %} onchange="
                        var base = {% if let Some(epic) = selected_epic %}'/graph/{{ epic }}'{% else %}'/graph'{% endif %};
                        window.location.href = this.checked ? base + '?include_closed=true' : base;
                    ">
                    Include Closed
                </label>
            </div>

            <div class="graph-tree-container">
                {% if tree_html.is_empty() %}
                <div class="graph-empty-state">Select an epic to view its dependency tree</div>
                {% else %}
                {{ tree_html|safe }}
                {% endif %}
            </div>

            <div class="graph-legend">
                <h3>Legend</h3>
                <div class="legend-section">
                    <h4>Status</h4>
                    <div class="legend-items">
                        <div class="legend-item"><span class="legend-color status-open"></span> Open</div>
                        <div class="legend-item"><span class="legend-color status-in_progress"></span> In Progress</div>
                        <div class="legend-item"><span class="legend-color status-blocked"></span> Blocked</div>
                        <div class="legend-item"><span class="legend-color status-closed"></span> Closed</div>
                    </div>
                </div>
                <div class="legend-section">
                    <h4>Type</h4>
                    <div class="legend-items">
                        <div class="legend-item"><span class="legend-color type-epic"></span> Epic</div>
                        <div class="legend-item"><span class="legend-color type-feature"></span> Feature</div>
                        <div class="legend-item"><span class="legend-color type-task"></span> Task</div>
                        <div class="legend-item"><span class="legend-color type-bug"></span> Bug</div>
                    </div>
                </div>
            </div>
        </div>
    </main>
{% include "_footer.html" %}
</body>
</html>
