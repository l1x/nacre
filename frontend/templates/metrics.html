<!DOCTYPE html>
<html lang="en">
<head>
    {% include "_head.html" %}
</head>
<body>
    {% include "_header.html" %}
    <main id="content">
        <div class="metrics-container">
            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>Avg Lead Time</h3>
                    <div class="metric-value">{{ avg_lead_time_hours|format_hours }}</div>
                    <div class="metric-label">Time from creation to close</div>
                </div>
                <div class="metric-card">
                    <h3>Avg Cycle Time</h3>
                    <div class="metric-value">{{ avg_cycle_time_mins|format_minutes }}</div>
                    <div class="metric-label">Time spent in progress</div>
                </div>
                <div class="metric-card">
                    <h3>Throughput</h3>
                    <div class="metric-value">{{ throughput_per_day|format_decimal }}</div>
                    <div class="metric-label">Issues closed per day (last 7d)</div>
                </div>
            </div>

            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>Velocity</h3>
                    <div class="metric-value">{{ closed_last_7_days }}</div>
                    <div class="metric-label">Issues closed in last 7 days</div>
                </div>
                <div class="metric-card">
                    <h3>WIP</h3>
                    <div class="metric-value">{{ wip_count }}</div>
                    <div class="metric-label">Issues currently in progress</div>
                </div>
                <div class="metric-card">
                    <h3>Blocked</h3>
                    <div class="metric-value">{{ blocked_count }}</div>
                    <div class="metric-label">Issues currently blocked</div>
                </div>
            </div>

            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>p50 Lead Time</h3>
                    <div class="metric-value">{{ p50_lead_time_hours|format_hours }}</div>
                    <div class="metric-label">Median lead time</div>
                </div>
                <div class="metric-card">
                    <h3>p90 Lead Time</h3>
                    <div class="metric-value">{{ p90_lead_time_hours|format_hours }}</div>
                    <div class="metric-label">90th percentile</div>
                </div>
                <div class="metric-card">
                    <h3>p100 Lead Time</h3>
                    <div class="metric-value">{{ p100_lead_time_hours|format_hours }}</div>
                    <div class="metric-label">Maximum lead time</div>
                </div>
            </div>

            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>p50 Cycle Time</h3>
                    <div class="metric-value">{{ p50_cycle_time_mins|format_minutes }}</div>
                    <div class="metric-label">Median cycle time</div>
                </div>
                <div class="metric-card">
                    <h3>p90 Cycle Time</h3>
                    <div class="metric-value">{{ p90_cycle_time_mins|format_minutes }}</div>
                    <div class="metric-label">90th percentile</div>
                </div>
                <div class="metric-card">
                    <h3>p100 Cycle Time</h3>
                    <div class="metric-value">{{ p100_cycle_time_mins|format_minutes }}</div>
                    <div class="metric-label">Maximum cycle time</div>
                </div>
            </div>

            <!-- Ticket Activity Chart -->
            <section class="metrics-section" id="ticket-activity">
                <h2>Ticket Activity <span class="chart-desc">Opened and Resolved tickets over time</span></h2>
                <div class="chart-container">
                    <div class="html-chart html-chart--show-values">
                        <div class="html-chart__legend">
                            {% for series in tickets_chart.series %}
                            <div class="html-chart__legend-item">
                                <span class="html-chart__legend-dot html-chart__legend-dot--{{ series.color }}"></span>
                                {{ series.name }}
                            </div>
                            {% endfor %}
                        </div>
                        <div class="html-chart__area">
                            <div class="html-chart__axis-layer">
                                <div class="html-chart__axis-y"></div>
                                <div class="html-chart__axis-x"></div>
                            </div>
                            <div class="html-chart__grid">
                                <div class="html-chart__grid-line" data-value="{{ tickets_chart.max_value|round }}"></div>
                                <div class="html-chart__grid-line" data-value="{{ (tickets_chart.max_value / 2.0)|round }}"></div>
                                <div class="html-chart__grid-line" data-value="0"></div>
                            </div>
                            <div class="html-chart__bars">
                                {% for i in 0..tickets_chart.labels.len() %}
                                <div class="html-chart__bar-group">
                                    {% for series in tickets_chart.series %}
                                    <div class="html-chart__bar html-chart__bar--{{ series.color }}"
                                         style="height: {{ series.bars[i].percent }}%;">
                                        <span class="html-chart__bar-value">{{ series.bars[i].display }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endfor %}
                                <div class="html-chart__x-axis">
                                    {% for label in tickets_chart.labels %}
                                    <span class="html-chart__x-label">{{ label }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Lead Time Chart -->
            {% if lead_time_chart.has_data() %}
            <section class="metrics-section" id="lead-time">
                <h2>Lead Time <span class="chart-desc">Time from creation to close</span></h2>
                <div class="chart-container">
                    <div class="html-chart html-chart--show-values">
                        <div class="html-chart__legend">
                            {% for series in lead_time_chart.series %}
                            <div class="html-chart__legend-item">
                                <span class="html-chart__legend-dot html-chart__legend-dot--{{ series.color }}"></span>
                                {{ series.name }}
                            </div>
                            {% endfor %}
                        </div>
                        <div class="html-chart__area">
                            <div class="html-chart__axis-layer">
                                <div class="html-chart__axis-y"></div>
                                <div class="html-chart__axis-x"></div>
                            </div>
                            <div class="html-chart__grid">
                                <div class="html-chart__grid-line" data-value="{{ lead_time_chart.max_value|round }}{{ lead_time_chart.unit }}"></div>
                                <div class="html-chart__grid-line" data-value="{{ (lead_time_chart.max_value / 2.0)|round }}{{ lead_time_chart.unit }}"></div>
                                <div class="html-chart__grid-line" data-value="0"></div>
                            </div>
                            <div class="html-chart__bars">
                                {% for i in 0..lead_time_chart.labels.len() %}
                                <div class="html-chart__bar-group">
                                    {% for series in lead_time_chart.series %}
                                    <div class="html-chart__bar html-chart__bar--{{ series.color }}"
                                         style="height: {{ series.bars[i].percent }}%;">
                                        <span class="html-chart__bar-value">{{ series.bars[i].display }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endfor %}
                                <div class="html-chart__x-axis">
                                    {% for label in lead_time_chart.labels %}
                                    <span class="html-chart__x-label">{{ label }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            {% endif %}

            <!-- Cycle Time Chart -->
            {% if cycle_time_chart.has_data() %}
            <section class="metrics-section" id="cycle-time">
                <h2>Cycle Time <span class="chart-desc">Time spent in progress</span></h2>
                <div class="chart-container">
                    <div class="html-chart html-chart--show-values">
                        <div class="html-chart__legend">
                            {% for series in cycle_time_chart.series %}
                            <div class="html-chart__legend-item">
                                <span class="html-chart__legend-dot html-chart__legend-dot--{{ series.color }}"></span>
                                {{ series.name }}
                            </div>
                            {% endfor %}
                        </div>
                        <div class="html-chart__area">
                            <div class="html-chart__axis-layer">
                                <div class="html-chart__axis-y"></div>
                                <div class="html-chart__axis-x"></div>
                            </div>
                            <div class="html-chart__grid">
                                <div class="html-chart__grid-line" data-value="{{ cycle_time_chart.max_value|round }}{{ cycle_time_chart.unit }}"></div>
                                <div class="html-chart__grid-line" data-value="{{ (cycle_time_chart.max_value / 2.0)|round }}{{ cycle_time_chart.unit }}"></div>
                                <div class="html-chart__grid-line" data-value="0"></div>
                            </div>
                            <div class="html-chart__bars">
                                {% for i in 0..cycle_time_chart.labels.len() %}
                                <div class="html-chart__bar-group">
                                    {% for series in cycle_time_chart.series %}
                                    <div class="html-chart__bar html-chart__bar--{{ series.color }}"
                                         style="height: {{ series.bars[i].percent }}%;">
                                        <span class="html-chart__bar-value">{{ series.bars[i].display }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endfor %}
                                <div class="html-chart__x-axis">
                                    {% for label in cycle_time_chart.labels %}
                                    <span class="html-chart__x-label">{{ label }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            {% endif %}

            <!-- Throughput Chart -->
            {% if throughput_chart.has_data() %}
            <section class="metrics-section" id="throughput">
                <h2>Throughput <span class="chart-desc">Issues closed per day</span></h2>
                <div class="chart-container">
                    <div class="html-chart html-chart--show-values">
                        <div class="html-chart__legend">
                            {% for series in throughput_chart.series %}
                            <div class="html-chart__legend-item">
                                <span class="html-chart__legend-dot html-chart__legend-dot--{{ series.color }}"></span>
                                {{ series.name }}
                            </div>
                            {% endfor %}
                        </div>
                        <div class="html-chart__area">
                            <div class="html-chart__axis-layer">
                                <div class="html-chart__axis-y"></div>
                                <div class="html-chart__axis-x"></div>
                            </div>
                            <div class="html-chart__grid">
                                <div class="html-chart__grid-line" data-value="{{ throughput_chart.max_value|round }}"></div>
                                <div class="html-chart__grid-line" data-value="{{ (throughput_chart.max_value / 2.0)|round }}"></div>
                                <div class="html-chart__grid-line" data-value="0"></div>
                            </div>
                            <div class="html-chart__bars">
                                {% for i in 0..throughput_chart.labels.len() %}
                                <div class="html-chart__bar-group">
                                    {% for series in throughput_chart.series %}
                                    <div class="html-chart__bar html-chart__bar--{{ series.color }}"
                                         style="height: {{ series.bars[i].percent }}%;">
                                        <span class="html-chart__bar-value">{{ series.bars[i].display }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endfor %}
                                <div class="html-chart__x-axis">
                                    {% for label in throughput_chart.labels %}
                                    <span class="html-chart__x-label">{{ label }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            {% endif %}

            <!-- Activity Heat Map -->
            {% if activity_heatmap.has_data() %}
            <section class="metrics-section" id="activity-heatmap">
                <h2>Activity Heat Map <span class="chart-desc">When work happens (hour Ã— day)</span></h2>
                <div class="heatmap-container">
                    <div class="heatmap">
                        <div class="heatmap-corner"></div>
                        <div class="heatmap-col-labels">
                            {% for label in activity_heatmap.col_labels %}
                            <span class="heatmap-col-label">{{ label }}</span>
                            {% endfor %}
                        </div>
                        {% for row_idx in 0..activity_heatmap.row_labels.len() %}
                        <div class="heatmap-row-label">{{ activity_heatmap.row_labels[row_idx] }}</div>
                        <div class="heatmap-row">
                            {% for cell in activity_heatmap.cells[row_idx] %}
                            <div class="heatmap-cell heatmap-intensity-{{ cell.intensity }}" title="{{ cell.value }} events">
                            </div>
                            {% endfor %}
                        </div>
                        {% endfor %}
                    </div>
                    <div class="heatmap-legend">
                        <span class="heatmap-legend-label">Less</span>
                        <div class="heatmap-cell heatmap-intensity-0"></div>
                        <div class="heatmap-cell heatmap-intensity-1"></div>
                        <div class="heatmap-cell heatmap-intensity-2"></div>
                        <div class="heatmap-cell heatmap-intensity-3"></div>
                        <div class="heatmap-cell heatmap-intensity-4"></div>
                        <span class="heatmap-legend-label">More</span>
                    </div>
                </div>
            </section>
            {% endif %}
        </div>
    </main>
{% include "_footer.html" %}
</body>
</html>
