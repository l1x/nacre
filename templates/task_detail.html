<!DOCTYPE html>
<html lang="en">
<head>
    {% include "_head.html" %}
</head>
<body>
    {% include "_header.html" %}
    <main id="content">
        <div class="epic-detail">
            <a href="/tasks/{{ task.issue.id }}/edit" class="edit-action-btn">Edit</a>
            <div class="scandi-header" style="margin-bottom: 24px;">
                <div class="issue-eyebrow">
                    <span>{{ task.issue.id }}</span>
                    <span>&middot;</span>
                    <span>{{ task.issue.issue_type }}</span>
                </div>
                <h1 class="issue-title-large">{{ task.issue.title }}</h1>

                <div class="issue-meta-row">
                    <span class="meta-chip status-{{ task.issue.status.as_str() }}"><span class="meta-label">Status:</span> {{ task.issue.status }}</span>
                    <span class="meta-chip"><span class="meta-label">Priority:</span> P{{ task.issue.priority.unwrap_or(2) }}</span>

                    {% if task.issue.assignee.is_some() %}
                    <span class="meta-chip assignee"><span class="meta-label">Assignee:</span> {{ task.issue.assignee.as_ref().unwrap() }}</span>
                    {% endif %}
                </div>
            </div>

            {% if task.total > 0 %}
            <div class="detail-section" style="margin-bottom: 24px;">
                <h3>Progress</h3>
                <div class="progress-container large" style="margin-bottom: 8px;">
                    <div class="progress-bar" style="width: {{ task.percent }}%"></div>
                </div>
                <div style="text-align: right; font-size: 0.85rem; color: var(--text-muted);">
                    {{ task.closed }} / {{ task.total }} tasks completed ({{ "{:.0}"|format(task.percent) }}%)
                </div>
            </div>
            {% endif %}

            {% if task.issue.description.is_some() %}
            <div class="detail-section">
                <h3>Description</h3>
                <div class="description-content">{{ task.issue.description.as_ref().unwrap()|markdown|safe }}</div>
            </div>
            {% endif %}

            {% if !task.children.is_empty() %}
            <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border-subtle);">
                <div class="detail-section">
                    <h3>Child Issues ({{ task.total }})</h3>
                    <div class="epic-children-list">
                        {% for child in task.children %}
                        <div class="epic-child-row" data-filter-text="{{ child.title|lower }} {{ child.id|lower }} {{ child.status|lower }}">
                            <span class="child-status status-{{ child.status.as_str() }}">{{ child.status }}</span>
                            <span class="child-type type-{{ child.issue_type.as_css_class() }}">{{ child.issue_type }}</span>
                            <a href="/tasks/{{ child.id }}" class="child-title">{{ child.title }}</a>
                            <span class="child-id">{{ child.id }}</span>
                            <span class="child-priority">P{{ child.priority.unwrap_or(0) }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="timestamps-grid" style="margin-top: 32px;">
                <div class="timestamp-item">
                    <span class="timestamp-value">{{ task.issue.created_at|format_date }}</span>
                    <span class="timestamp-label">Created</span>
                </div>
                <div class="separator"></div>
                <div class="timestamp-item">
                    <span class="timestamp-value">{{ task.issue.updated_at|format_date }}</span>
                    <span class="timestamp-label">Updated</span>
                </div>
                {% if task.issue.closed_at.is_some() %}
                <div class="separator"></div>
                <div class="timestamp-item">
                    <span class="timestamp-value">{{ task.issue.closed_at.as_ref().unwrap()|format_date }}</span>
                    <span class="timestamp-label">Closed</span>
                </div>
                {% endif %}
            </div>
        </div>
    </main>
{% include "_footer.html" %}
</body>
</html>
